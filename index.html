<!DOCTYPE html>
<html lang="es">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg width='32' height='32' viewBox='0 0 100 100' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='50' cy='50' r='35' fill='%231A237E'/%3E%3Cellipse cx='50' cy='50' rx='45' ry='25' transform='rotate(-30 50 50)' stroke='%2300BCD4' stroke-width='6' fill='none'/%3E%3Ccircle cx='50' cy='50' r='10' fill='%23FFFFFF'/%3E%3C/svg%3E"/>
    <title>OMEGA - FIJO SOPORTE (Versi√≥n Corporativa)</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Paleta de Colores Base - Se modificar√°n con JS */
        :root {
            --azul-oscuro: #1A237E;
            --morado: #6A1B9A;
            --turquesa: #00BCD4;
            --gris-claro: #F0F0F0;
            --blanco: #FFFFFF;
            --texto-oscuro: #333;
            --texto-intermedio: #555;
            --texto-claro: #ccc; /* Para tabs no activas */
            --rojo-claro: #e74c3c;
            --rojo-oscuro: #c0392b;
            --verde-claro: #28a745; /* Para bot√≥n "Agregar Recuadro" */
            --verde-oscuro: #218838; /* Hover para bot√≥n "Agregar Recuadro" */
            
            /* Colores para la animaci√≥n de neuronas */
            --neuron-color-1-rgb: "106, 27, 154"; /* Morado */
            --neuron-color-2-rgb: "0, 188, 212";   /* Turquesa */
            --neuron-color-3-rgb: "26, 35, 126";   /* Azul Oscuro */
            --neuron-connection-rgb: "106, 27, 154"; /* Morado para conexiones por defecto */
        }

        /* Estilos Generales del Cuerpo y P√°gina de Aterrizaje */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--gris-claro);
            color: var(--texto-oscuro);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            padding-bottom: 80px; /* Espacio para los widgets inferiores */
            overflow-x: hidden; /* Prevenir scroll horizontal ocasional */
        }

        #neuronCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        #landingPage {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            min-height: 100vh;
            text-align: center;
            position: relative;
            z-index: 2;
        }

        #landingPage h1 {
            font-size: 4em;
            margin-bottom: 40px;
            color: var(--azul-oscuro);
            text-shadow: 2px 2px 8px rgba(26, 35, 126, 0.4); /* Sombra azul */
            letter-spacing: 2px;
            display: flex; /* Para alinear el SVG con el texto */
            align-items: center; /* Centrar verticalmente el SVG */
            justify-content: center; /* Centrar horizontalmente el contenido */
            gap: 10px; /* Espacio entre el logo y el texto */
        }

        #landingPage h1 .logo-inline {
            width: 1.8em; 
            height: 1.8em; 
            vertical-align: middle; /* Alineaci√≥n vertical */
        }
        /* Logo en landing page (si se usa) */
        #landingPageLogo {
            position: absolute;
            top: 20px;
            left: 20px; 
            height: 60px; 
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }


        /* Estilo general para botones */
        .button, button.data-action-btn {
            background: linear-gradient(to right, var(--morado), var(--azul-oscuro));
            border: none;
            color: var(--blanco);
            padding: 14px 28px;
            font-size: 17px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 0.5px;
            margin: 5px; 
        }

        .button:hover, button.data-action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            background: linear-gradient(to right, var(--azul-oscuro), var(--morado));
        }

        .button.clear-button, button.clear-button.data-action-btn {
            background: linear-gradient(to right, var(--rojo-claro), var(--rojo-oscuro));
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
            padding: 10px 20px;
            font-size: 14px;
        }
        .button.clear-button:hover, button.clear-button.data-action-btn:hover {
            background: linear-gradient(to right, var(--rojo-oscuro), var(--rojo-claro));
            transform: translateY(-1px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.25);
        }

        .manage-button {
            background: var(--morado); 
            color: var(--blanco);
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 15px;
            cursor: pointer;
            border: none;
            margin-left: 10px;
            text-transform: none;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        }
        .manage-button.remove-item { background: var(--rojo-claro); }
        .manage-button:hover { filter: brightness(1.1); transform: translateY(-1px); }


        /* P√°gina de Contenido Principal y Barra de T√≠tulo */
        #mainContentPage {
            display: none; 
            width: 100%;
            min-height: 100vh;
            position: relative;
            z-index: 1;
            overflow-y: auto;
            box-sizing: border-box;
            background-color: transparent;
        }

        #mainTitleBar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: var(--azul-oscuro); 
            color: var(--blanco); 
            padding: 10px 20px; 
            border-bottom: 3px solid var(--turquesa); 
            z-index: 1000;
            font-size: 1.8em;
            font-weight: 700;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            height: 70px; 
            box-sizing: border-box;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #mainTitleText { flex-grow: 1; text-align: center; color: var(--blanco); }
        .data-actions-container {
            display: flex; 
            flex-direction: row; 
            gap: 10px; 
            align-items: center;
            margin-left: 20px; 
        }
        .data-actions-container button.data-action-btn, .data-actions-container label.data-action-btn {
            padding: 8px 15px;
            font-size: 14px;
            border-radius: 20px;
            background: var(--morado); 
            color: var(--blanco);
            display: flex; 
            align-items: center;
            justify-content: center;
        }
        .data-actions-container button.data-action-btn:hover, .data-actions-container label.data-action-btn:hover {
            background: var(--azul-oscuro); 
        }
        
        #headerLogo {
            height: 65px; 
            width: 65px; 
            border-radius: 8px;
            margin-right: 15px;
        }
        #mainTitleBar .logo-left { margin-right: auto; } 


        /* Timer en la barra superior */
        #topTimerContainer {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--blanco);
            font-size: 1.2em;
            font-weight: 500;
            margin-left: auto; /* Mueve el temporizador a la derecha */
        }
        #topTimerDisplay {
            font-size: 1.1em;
            font-weight: 700;
            color: var(--turquesa); 
        }
        #topTimerInputMinutes {
            width: 60px;
            padding: 5px 8px;
            border-radius: 5px;
            border: 1px solid var(--turquesa);
            background-color: rgba(255,255,255,0.1); /* Considerar si este blanco debe ser variable */
            color: var(--blanco);
            text-align: center;
            font-size: 1em;
        }
        #topTimerInputMinutes::placeholder {
            color: rgba(255,255,255,0.7);
        }
        #topTimerControls button {
            padding: 6px 12px;
            font-size: 0.8em; 
            border-radius: 15px;
            background: var(--turquesa); 
            color: var(--azul-oscuro); 
            border: none;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        #topTimerControls button:hover {
            background: #0097A7; /* Un turquesa m√°s oscuro, podr√≠a ser var(--turquesa-oscuro) */
        }
        #topTimerControls button.clear-button {
            background: var(--rojo-claro);
            color: var(--blanco);
        }
        #topTimerControls button.clear-button:hover {
            background: var(--rojo-oscuro);
        }


        /* Estilos para Tabs */
        .tab-container {
            width: 100%;
            padding-top: 70px; 
        }
        .tab-nav {
            display: flex;
            background-color: var(--texto-oscuro); /* #333 */
            border-bottom: 1px solid var(--morado); 
            position: sticky;
            top: 70px; 
            z-index: 999;
            flex-wrap: wrap;
        }
        .tab-link {
            padding: 12px 18px; cursor: pointer; border: none;
            border-bottom: 4px solid transparent; background-color: transparent;
            font-size: 1em; font-weight: 500; color: var(--texto-claro); /* #ccc */
            transition: all 0.3s ease; flex-grow: 1; text-align: center;
        }
        .tab-link:hover { background-color: #444; color: var(--blanco); } /* #444 podr√≠a ser var(--gris-oscuro-hover) */
        .tab-link.active {
            border-bottom-color: var(--turquesa); 
            color: var(--turquesa); 
            font-weight: 700; background-color: #2a2a2a; /* Podr√≠a ser var(--gris-muy-oscuro) */
        }

        .tab-content {
            display: none;
            padding: 25px;
            animation: fadeInTab 0.5s;
            background-color: transparent;
            position: relative; 
            padding-bottom: 100px; 
        }
        .tab-content.active { display: block; }
        @keyframes fadeInTab {
            from { opacity: 0; }
            to { opacity: 1; }
        }


        /* Contenedores de Formularios y Secciones */
        .main-container-tab { 
            display: flex; 
            flex-wrap: wrap;
            justify-content: center;
            gap: 25px;
            width: 100%;
            margin: 0 auto;
            box-sizing: border-box;
        }

        .draggable-box {
            background-color: rgba(255, 255, 255, 0.9); /* Blanco semi-transparente, podr√≠a ser var(--blanco-transparente) */
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.2s ease;
            margin-bottom: 25px; 
            position: relative; 
            z-index: 1; 
            width: calc(33% - 20px); 
            min-width: 280px; 
            box-sizing: border-box;
            resize: both; 
            overflow: auto; 
            cursor: default; 
        }
        .draggable-box.dragging {
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            z-index: 100; 
            opacity: 0.9;
        }
        
        .drag-handle {
            cursor: grab;
            padding-bottom: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(106, 27, 154, 0.3); /* Morado transparente, podr√≠a ser var(--morado-transparente) */
            display: flex; 
            justify-content: center;
            align-items: center;
            position: relative; 
        }
        .drag-handle:active { cursor: grabbing; }

        .draggable-box h2, .draggable-box h3, .draggable-box h5 {
            text-align: center; margin-top: 0;
            font-weight: 700; color: var(--azul-oscuro); 
            font-size: 2em; 
            flex-grow: 1; 
        }
        .draggable-box h3 { font-size: 1.8em; } 
        .draggable-box h5 { font-size: 1.6em; } 

        .edit-title-btn, .remove-box-btn {
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            color: var(--morado); 
            margin-left: 10px;
            padding: 5px;
            border-radius: 50%;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .edit-title-btn:hover { background-color: rgba(106, 27, 154, 0.1); color: var(--azul-oscuro); }
        .remove-box-btn { color: var(--rojo-claro); font-size: 1.5em; }
        .remove-box-btn:hover { background-color: rgba(231, 76, 60, 0.1); }


        /* Grupos de Formulario y Entradas */
        .form-group { margin-bottom: 25px; }
        .form-group label {
            margin-bottom: 10px; font-size: 16px; color: var(--texto-intermedio); display: block; font-weight: 500;
        }
        .form-group input, .form-group textarea, .dropdown, .dynamic-input {
            width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ddd; /* #ddd podr√≠a ser var(--borde-claro) */
            background-color: #fefefe; font-size: 16px; color: var(--texto-oscuro); box-sizing: border-box;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .form-group input:focus, .form-group textarea:focus, .dropdown:focus, .dynamic-input:focus {
            border-color: var(--turquesa); 
            box-shadow: 0 0 0 4px rgba(0, 188, 212, 0.2); /* Sombra turquesa, podr√≠a ser var(--turquesa-sombra) */
            outline: none;
        }
        .form-group textarea, .dynamic-input[type="textarea"] { resize: vertical; min-height: 120px; }

        /* Checkboxes */
        .checkbox-item-container {
            display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;
        }
        .checkbox-item-container label {
            display: flex; align-items: center; font-size: 16px; color: #444; cursor: pointer; /* #444 podr√≠a ser var(--texto-oscuro-ligero) */
            transition: color 0.2s ease; flex-grow: 1; margin-bottom:0;
        }
        .checkbox-item-container label:hover { color: var(--morado); }
        .checkbox-item-container input[type="checkbox"] {
            margin-right: 12px; transform: scale(1.3); accent-color: var(--turquesa); 
            min-width: 18px; min-height: 18px;
        }
        .add-item-btn-container { margin-top: 15px; text-align: right; }

        /* Estilos para Formularios Din√°micos (Memos de Quejas) */
        #formContainerMemoQuejas {
            margin-top: 20px;
            border-top: 1px dashed rgba(106, 27, 154, 0.3); /* Morado transparente */
            padding-top: 20px;
        }
        #formContainerMemoQuejas .form-group label {
            font-size: 15px; 
            margin-bottom: 6px;
        }
        #formContainerMemoQuejas .dynamic-input, #formContainerMemoQuejas textarea {
             padding: 12px;
             font-size: 16px; 
             border-radius: 8px;
        }
         #formContainerMemoQuejas textarea {
             min-height: 90px;
         }

        .dynamic-checkbox-group { /* Contenedor para grupos de checkboxes din√°micos */
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee; /* Separador */
        }

        .dynamic-checkbox-group > label {
            display: block;
            margin-bottom: 10px;
            color: var(--azul-oscuro); 
            font-size: 16px; 
            font-weight: 500;
        }
        .dynamic-checkbox-group input[type="checkbox"] {
            margin-right: 8px;
            accent-color: var(--turquesa); 
            transform: scale(1.2);
        }
        /* Estilo para que los checkboxes en grupos din√°micos sean horizontales */
        .checkbox-group-inline {
            display: flex;
            flex-wrap: wrap; /* Permite que los elementos se envuelvan a la siguiente l√≠nea */
            gap: 15px; /* Espacio entre los checkboxes */
        }
         .checkbox-group-inline div {
            display: flex;
            align-items: center;
        }
         .checkbox-group-inline div label {
            font-size: 16px; 
            color: #444; /* Podr√≠a ser var(--texto-oscuro-ligero) */
            cursor: pointer;
            margin-bottom: 0;
        }

        /* Estilos para la lista de transferencias */
        .transfers-list {
            background-color: rgba(0, 188, 212, 0.1); /* Turquesa muy tenue, podr√≠a ser var(--turquesa-muy-tenue) */
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(0, 188, 212, 0.3); /* Turquesa transparente */
        }
        .transfers-list p {
            margin: 8px 0;
            font-size: 16px; 
            color: var(--texto-intermedio);
            line-height: 1.6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .transfers-list strong {
            color: var(--azul-oscuro); 
            font-weight: 700;
        }

        /* Firma */
        .firma-keiner {
            margin-top: 40px;
            margin-bottom: 20px;
            text-align: left;
            padding-left: 20px;
            color: #7f8c8d; /* Podr√≠a ser var(--texto-gris-firma) */
            font-style: italic;
            font-size: 14px;
            font-weight: bold;
        }

        /* Contenedor de Widgets Inferiores y Botones Toggle */
        #bottomWidgetsContainer {
            position: fixed; bottom: 0; right: 0; padding: 10px;
            display: none; 
            gap: 10px;
            z-index: 9998; align-items: flex-end;
        }
        .widget-toggle-button {
            background: linear-gradient(to right, var(--morado), var(--azul-oscuro));
            width: 55px; height: 55px;
            color: var(--blanco); font-size: 26px;
            border: none; border-radius: 50%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            cursor: pointer; display: flex; justify-content: center; align-items: center;
            transition: all 0.3s ease;
        }
        .widget-toggle-button:hover {
            transform: scale(1.05) translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            background: linear-gradient(to right, var(--azul-oscuro), var(--morado));
        }
        .widget-toggle-button.active-toggle { 
             background: linear-gradient(to right, var(--rojo-claro), var(--rojo-oscuro)); 
        }
        #toggleNotes { background: linear-gradient(to right, var(--turquesa), #0097A7); } /* #0097A7 podr√≠a ser var(--turquesa-oscuro) */
        #toggleNotes.active-toggle { background: linear-gradient(to right, var(--rojo-claro), var(--rojo-oscuro)); }
        #toggleAddBox { background: linear-gradient(to right, var(--verde-claro), var(--verde-oscuro)); } 
        #toggleAddBox.active-toggle { background: linear-gradient(to right, var(--rojo-claro), var(--rojo-oscuro)); }
        #toggleTheme { background: linear-gradient(to right, #ff9800, #f57c00); } /* Naranja para el bot√≥n de tema */
        #toggleTheme.active-toggle { background: linear-gradient(to right, var(--rojo-claro), var(--rojo-oscuro)); }


        /* Paneles de Widgets */
        .widget-panel {
            width: 360px;
            height: auto; /* Cambiado a auto para acomodar contenido variable */
            max-height: 70vh; /* Altura m√°xima para evitar que sea demasiado grande */
            overflow-y: auto; /* Scroll si el contenido excede */
            background: rgba(255, 255, 255, 0.98); /* Ligeramente m√°s opaco */
            border-radius: 15px;
            box-shadow: 0 0 25px rgba(0,0,0,0.3);
            display: none; 
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
            animation: fadeInScale 0.3s ease-out forwards;
            border-top: 4px solid var(--morado); 
            position: fixed; 
            z-index: 9997;
        }
        .widget-panel.active-widget { display: flex !important; } 

        .widget-panel .widget-header {
            font-size: 1.6em; font-weight: 700; color: var(--azul-oscuro); 
            text-align: center; margin-bottom: 15px; padding-bottom: 10px;
            border-bottom: 1px solid rgba(106, 27, 154, 0.3); /* Morado transparente */
        }

        /* Notes Widget Espec√≠fico */
        #notesArea {
            width: 100%; flex-grow: 1; padding: 10px; border-radius: 8px;
            border: 1px solid #ddd; font-size: 16px; margin-bottom: 10px;
            background-color: #fefefe; min-height: 150px; /* Altura m√≠nima para notas */
        }
        #notesArea:focus { border-color: var(--turquesa); box-shadow: 0 0 0 3px rgba(0, 188, 212, 0.15); }
        .button-group-notes { display: flex; gap: 10px; justify-content: flex-end; }
        .button-group-notes .button { padding: 8px 15px; font-size: 14px; min-width: 100px; }

        /* Copilot Widget Espec√≠fico */
        #copilotWidget { padding: 0; height: 500px; /* Altura fija para el iframe de copilot */ }
        #copilotWidget iframe { width: 100%; height: 100%; border: none; }

        /* Theme Widget Espec√≠fico */
        #themeWidgetPanel .theme-color-group {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--texto-claro);
        }
        #themeWidgetPanel .theme-color-group:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        #themeWidgetPanel label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--texto-intermedio);
        }
        #themeWidgetPanel input[type="color"] {
            width: 100%;
            height: 40px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 2px;
            box-sizing: border-box;
            cursor: pointer;
        }
        #themeWidgetPanel .button-group-theme {
            display: flex;
            gap: 10px;
            justify-content: space-between; /* Para separar los botones */
            margin-top: 20px;
        }
         #themeWidgetPanel .button-group-theme .button {
            flex-grow: 1; /* Para que los botones ocupen espacio equitativo */
         }


        /* Dynamic checkbox area within custom boxes */
        .dynamic-checkbox-area {
            border-top: 1px dashed rgba(106, 27, 154, 0.3);
            padding-top: 15px;
            margin-top: 15px;
        }
        .dynamic-checkbox-area .checkbox-item-container {
            margin-bottom: 10px;
        }
        .dynamic-checkbox-area .add-item-btn-container {
            margin-top: 10px;
        }

        /* TMO Calculator Specific Styles */
        #tab6 .main-container-tab {
            display: flex;
            flex-direction: row; /* Default to row for TMO calculator */
            justify-content: center;
            align-items: flex-start; /* Align items at the top */
            gap: 20px;
            width: 100%;
            max-width: 950px; /* Max width for the combined content */
            margin: 0 auto;
            box-sizing: border-box;
        }

        #tab6 #minutesToSecondsConverter,
        #tab6 #tmoMessageBox {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            width: 100%;
            max-width: 450px;
            box-sizing: border-box;
            text-align: center;
        }

        #tab6 #minutesToSecondsConverter {
            border-top: 5px solid var(--morado);
        }

        #tab6 #tmoMessageBox {
            border: 5px solid var(--turquesa);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            font-weight: 700;
            color: var(--azul-oscuro);
            text-shadow: 1px 1px 3px rgba(26, 35, 126, 0.1);
            line-height: 1.4;
            min-height: 200px; /* Ensure it has some height */
        }

        #tab6 #minutesToSecondsConverter h3 {
            color: var(--azul-oscuro);
            font-size: 2.2em;
            font-weight: 700;
            margin-top: 0;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(106, 27, 154, 0.3);
            text-shadow: 1px 1px 3px rgba(26, 35, 126, 0.1);
        }

        #tab6 #minutesInput {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #ddd;
            background-color: #fefefe;
            font-size: 1.4em;
            color: var(--texto-oscuro);
            box-sizing: border-box;
            text-align: center;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        #tab6 #minutesInput:focus {
            border-color: var(--turquesa);
            box-shadow: 0 0 0 4px rgba(0, 188, 212, 0.25);
            outline: none;
        }

        #tab6 #secondsResult {
            text-align: center;
            font-size: 2.5em;
            font-weight: 700;
            margin-top: 30px;
            padding: 15px 10px;
            background-color: rgba(0, 188, 212, 0.1);
            border-radius: 12px;
            border: 2px solid var(--turquesa);
            color: var(--turquesa);
            transition: all 0.3s ease;
        }

        /* Result Colors for TMO Calculator */
        #tab6 .result-red {
            color: var(--rojo-oscuro) !important;
            border-color: var(--rojo-oscuro) !important;
            background-color: rgba(231, 76, 60, 0.1) !important;
        }

        #tab6 .result-green {
            color: var(--verde-oscuro) !important;
            border-color: var(--verde-oscuro) !important;
            background-color: rgba(40, 167, 69, 0.1) !important;
        }

        /* Styles for Avisos Tab (tab7) - Specific from recuadros.html */
        .notices-display {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            border-top: 5px solid var(--turquesa);
            min-height: 250px;
        }
        .notices-display h3 {
            color: var(--azul-oscuro);
            font-size: 1.8em;
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 188, 212, 0.3);
        }
        .notice-item {
            background-color: #f8f8f8;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid #eee;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        .notice-item:last-child {
            margin-bottom: 0;
        }
        .notice-item h4 {
            color: var(--morado);
            font-size: 1.4em;
            margin-top: 0;
            margin-bottom: 10px;
        }
        .notice-item p {
            color: var(--texto-oscuro);
            font-size: 1em;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        .notice-item .notice-meta {
            font-size: 0.85em;
            color: var(--texto-intermedio);
            margin-top: 10px;
            text-align: right;
        }
        .no-notices-message {
            text-align: center;
            color: var(--texto-intermedio);
            font-style: italic;
            padding: 20px;
        }

        /* Styles for Document Viewer Boxes */
        .document-viewer-box {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            border-top: 5px solid var(--morado);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 350px;
        }
        .document-viewer-box .drag-handle {
            margin-bottom: 15px;
        }
        .document-viewer-box iframe {
            flex-grow: 1;
            min-height: 200px;
            width: 100%; /* Asegura que el iframe ocupe el 100% del ancho del contenedor */
            height: 100%; /* Asegura que el iframe ocupe el 100% de la altura del contenedor */
            border: none;
            border-radius: 8px;
        }
        .document-iframe-container {
            width: 100%;
            height: calc(100% - 60px); /* Ajusta la altura para dejar espacio al t√≠tulo y bot√≥n */
            display: flex; /* Para centrar el mensaje de error */
            justify-content: center;
            align-items: center;
        }
        .document-viewer-box .button {
            padding: 8px 15px;
            font-size: 0.9em;
            margin-top: 15px;
        }
        /* Estilos para el mensaje de error del iframe */
        .iframe-error-message {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            background-color: #fdd; /* Fondo rojo claro */
            color: #c00; /* Texto rojo oscuro */
            border: 1px solid #f00;
            border-radius: 8px;
            font-size: 1.1em;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Estilos para el aviso emergente */
        .popup-modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 10001; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.7); /* Black w/ opacity */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .popup-content {
            background-color: var(--blanco);
            margin: auto;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            text-align: center;
            max-width: 500px;
            position: relative;
            animation: fadeInScale 0.3s ease-out forwards;
            border-top: 5px solid var(--turquesa);
        }

        .popup-content h2 {
            color: var(--azul-oscuro);
            font-size: 2em;
            margin-top: 0;
            margin-bottom: 15px;
        }

        .popup-content p {
            color: var(--texto-oscuro);
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .popup-close-btn {
            background-color: var(--morado);
            color: var(--blanco);
            padding: 10px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .popup-close-btn:hover {
            background-color: var(--azul-oscuro);
            transform: translateY(-2px);
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }


        /* Responsive Adjustments */
        @media (min-width: 900px) { /* Apply side-by-side layout on larger screens */
            #tab6 .main-container-tab {
                flex-direction: row;
                align-items: flex-start; /* Align items at the top */
            }
            #tab6 #tmoMessageBox {
                min-height: 350px; /* Adjust height to match calculator roughly */
            }
        }

        @media (max-width: 899px) { /* Stack vertically on smaller screens */
            #tab6 .main-container-tab {
                flex-direction: column;
            }
            #tab6 #tmoMessageBox {
                min-height: 150px; /* Smaller height when stacked */
            }
        }

        @media (max-width: 600px) {
            #omegaHeader {
                font-size: 1.2em;
                top: 10px;
                right: 10px;
                gap: 5px;
            }
            #omegaHeader .logo-inline {
                width: 1.2em;
                height: 1.2em;
            }

            #minutesToSecondsConverter, #tmoMessageBox {
                padding: 20px;
                border-radius: 15px;
                max-width: 100%; /* Ensure it takes full width */
            }

            #minutesToSecondsConverter h3 {
                font-size: 1.8em;
                margin-bottom: 20px;
                padding-bottom: 10px;
            }
            #tmoMessageBox {
                font-size: 1.5em;
                min-height: 120px;
            }

            .form-group label {
                font-size: 1em;
            }

            #minutesInput {
                padding: 12px;
                font-size: 1.2em;
            }

            .button {
                padding: 12px 25px;
                font-size: 1.1em;
            }

            #secondsResult {
                font-size: 2em;
                margin-top: 25px;
                padding: 12px 8px;
            }

            .popup-content {
                max-width: 90%;
                padding: 20px;
            }
            .popup-content h2 {
                font-size: 1.8em;
            }
            .popup-content p {
                font-size: 1em;
            }
        }

        @media (max-width: 400px) {
            #omegaHeader {
                font-size: 1em;
            }
            #omegaHeader .logo-inline {
                width: 1em;
                height: 1em;
            }

            #minutesToSecondsConverter, #tmoMessageBox {
                padding: 15px;
                border-radius: 10px;
            }
            #minutesToSecondsConverter h3 {
                font-size: 1.6em;
            }
            #tmoMessageBox {
                font-size: 1.2em;
                min-height: 100px;
            }
            #minutesInput {
                font-size: 1.1em;
            }
            .button {
                font-size: 1em;
            }
            #secondsResult {
                font-size: 1.8em;
            }
        }

        @media (max-width: 1650px) {
            .main-container-tab {
                justify-content: center;
            }
            .draggable-box { 
                width: calc(33% - 20px);
                max-width: none;
                min-width: 280px;
            }
            .checkboxes-area-tab { 
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 25px;
                width: calc(66% - 20px); 
                min-width: 580px; 
            }
            .checkboxes-area-tab .checkbox-group {
                width: calc(50% - 12.5px); 
            }
        }

        @media (max-width: 1200px) {
            #landingPage h1 { font-size: 3.5em; }
            #mainTitleBar { font-size: 1.5em; padding: 12px 15px; height: auto; flex-wrap: wrap; }
            #mainTitleBar .logo-left { margin-right: 10px; } 
            #mainTitleText { flex-basis: 100%; text-align: center; margin-bottom: 10px; }
            #topTimerContainer { flex-basis: 100%; justify-content: center; margin-bottom: 10px; }
            .data-actions-container { flex-basis: 100%; justify-content: center; margin-left: 0; }

            .main-container-tab {
                flex-direction: column;
                align-items: center;
                padding: 20px;
            }
            .draggable-box { 
                width: 95%;
                max-width: 600px;
                margin: 0;
                margin-bottom: 25px;
            }
            .checkboxes-area-tab {
                width: 95%;
                max-width: 600px;
                flex-direction: row; 
                justify-content: center;
            }
            .checkboxes-area-tab .checkbox-group {
                width: calc(50% - 12.5px);
            }

            #bottomWidgetsContainer {
                bottom: 10px;
                right: 10px;
                left: auto;
                justify-content: flex-end;
            }
            .widget-panel {
                bottom: 75px !important; 
                right: 10px !important;
                left: auto !important;
            }
        }

        @media (max-width: 768px) {
            #landingPage h1 { font-size: 2.8em; }
            .button { padding: 12px 20px; font-size: 16px; }

            #mainTitleBar { font-size: 1.3em; height: auto; flex-direction: column; padding: 8px 10px; }
            #mainTitleBar .logo-left { margin-right: 0; margin-bottom: 5px; } 
            #mainTitleText { margin-bottom: 5px; font-size: 1.2em; }
            .data-actions-container { margin-top: 5px; flex-wrap: wrap; justify-content: center;}
            .data-actions-container button.data-action-btn, .data-actions-container label.data-action-btn { font-size: 12px; padding: 6px 10px; }
            #topTimerContainer { margin-top: 5px; }
            #topTimerDisplay { font-size: 1.2em; }
            #topTimerInputMinutes { width: 50px; font-size: 0.9em; }
            #topTimerControls button { font-size: 0.8em; padding: 5px 10px; }


            .tab-nav { top: 120px; } 
            .tab-container { padding-top: 120px; }
            .tab-link { font-size: 0.85em; padding: 10px 3px; }

            .draggable-box { 
                width: 100% !important; 
                left: 0 !important; 
                top: auto !important; 
                position: relative !important; 
                margin: 10px auto !important; 
                resize: none; 
            }
            .checkboxes-area-tab {
                flex-direction: column; 
                align-items: center;
            }
            .checkboxes-area-tab .checkbox-group {
                width: 100%;
                max-width: 350px;
            }

            .widget-panel { width: calc(100% - 20px); max-width:340px; height: auto; max-height: 60vh; bottom: 75px !important; right: 10px !important;}
            .widget-toggle-button { width: 50px; height: 50px; font-size: 24px; }
            #bottomWidgetsContainer { padding: 5px; gap: 5px; justify-content: center; flex-wrap:wrap; }

            .firma-keiner { font-size: 12px; padding-left: 10px; }
        }
        @media (max-width: 480px) {
            body { padding-bottom: 60px; }
            /* Ajuste para la barra de t√≠tulo en m√≥viles peque√±os si es necesario */
            /* .tab-nav { top: XXpx; } .tab-container { padding-top: XXpx; } */


            .widget-toggle-button { width: 45px; height: 45px; font-size: 20px; }
            .widget-panel { min-height: 280px; max-height: 55vh; }
            .firma-keiner { font-size: 11px; }
        }

    </style>
</head>
<body>
    <canvas id="neuronCanvas"></canvas>

    <div id="landingPage">
        <h1>
            <svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" class="logo-inline">
              <circle cx="50" cy="50" r="35" fill="var(--blanco)"/>
              <circle cx="50" cy="50" r="30" fill="var(--azul-oscuro)"/>
              <ellipse cx="50" cy="50" rx="45" ry="25" transform="rotate(-30 50 50)" stroke="var(--turquesa)" stroke-width="3" fill="none"/>
              <ellipse cx="50" cy="50" rx="45" ry="25" transform="rotate(30 50 50)" stroke="var(--morado)" stroke-width="3" fill="none"/>
              <circle cx="50" cy="50" r="40" stroke="var(--azul-oscuro)" stroke-width="2" fill="none"/>
              <circle cx="28" cy="58" r="5" fill="var(--turquesa)" class="electron-dot"/>
              <circle cx="72" cy="42" r="5" fill="var(--blanco)" class="electron-dot"/>
              <circle cx="28" cy="42" r="5" fill="var(--morado)" class="electron-dot"/>
              <circle cx="72" cy="58" r="5" fill="var(--blanco)" class="electron-dot"/>
              <circle cx="50" cy="10" r="5" fill="var(--turquesa)" class="electron-dot"/>
              <circle cx="50" cy="90" r="5" fill="var(--blanco)" class="electron-dot"/>
            </svg>
            MEGA - FIJO SOPORTE
        </h1>
        <button id="siguienteBtn" class="button">Siguiente</button>
        </div>

    <div id="mainContentPage">
        <div id="mainTitleBar">
            <svg id="headerLogo" class="logo-left" width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="50" cy="50" r="35" fill="var(--blanco)"/>
              <circle cx="50" cy="50" r="30" fill="var(--azul-oscuro)"/>
              <ellipse cx="50" cy="50" rx="45" ry="25" transform="rotate(-30 50 50)" stroke="var(--turquesa)" stroke-width="3" fill="none"/>
              <ellipse cx="50" cy="50" rx="45" ry="25" transform="rotate(30 50 50)" stroke="var(--morado)" stroke-width="3" fill="none"/>
              <circle cx="50" cy="50" r="40" stroke="var(--azul-oscuro)" stroke-width="2" fill="none"/>
              <circle cx="28" cy="58" r="5" fill="var(--turquesa)" class="electron-dot"/>
              <circle cx="72" cy="42" r="5" fill="var(--blanco)" class="electron-dot"/>
              <circle cx="28" cy="42" r="5" fill="var(--morado)" class="electron-dot"/>
              <circle cx="72" cy="58" r="5" fill="var(--blanco)" class="electron-dot"/>
              <circle cx="50" cy="10" r="5" fill="var(--turquesa)" class="electron-dot"/>
              <circle cx="50" cy="90" r="5" fill="var(--blanco)" class="electron-dot"/>
            </svg>
            <span id="mainTitleText">OMEGA-FIJO SOPORTE</span>
            <div id="topTimerContainer">
                <span id="topTimerDisplay">05:00</span>
                <input type="number" id="topTimerInputMinutes" value="5" min="1" placeholder="Min"/>
                <div id="topTimerControls">
                    <button id="startTimerBtnTop">‚ñ∂Ô∏è</button>
                    <button id="stopTimerBtnTop" class="clear-button">‚èπÔ∏è</button>
                    <button id="resetTimerBtnTop">üîÑ</button>
                </div>
            </div>
            <div class="data-actions-container">
                <button id="saveDataBtn" class="button data-action-btn" title="Guardar datos">Guardar</button>
                <button id="exportDataBtn" class="button data-action-btn" title="Exportar datos">Exportar</button>
                <label for="importDataInput" class="button data-action-btn" title="Importar datos" style="cursor:pointer;">Importar</label>
                <input type="file" id="importDataInput" accept=".json" style="display:none;">
            </div>
        </div>

        <div class="tab-container">
            <div class="tab-nav">
                <button class="tab-link active" data-tab="tab1">Plantilla Gen√©rica</button>
                <button class="tab-link" data-tab="tab2">Memos de Quejas</button>
                <button class="tab-link" data-tab="tab3">Plantillas WF</button>
                <button class="tab-link" data-tab="tab4">Transferencias</button>
                <button class="tab-link" data-tab="tab5">Plantillas Guardadas</button>
                <button class="tab-link" data-tab="tab6">Calculadora TMO</button> <!-- New Tab Link -->
                <button class="tab-link" data-tab="tab7">Avisos</button> <!-- New Tab Link for Avisos -->
            </div>

            <div id="tab1" class="tab-content active">
                <div class="main-container-tab">
                    <div class="form-container draggable-box" id="form-container-tab1">
                        <h2 class="drag-handle">
                            <span>Plantilla Gen√©rica</span>
                            <button type="button" class="edit-title-btn" onclick="editBoxTitle(this.closest('.drag-handle').querySelector('span'))">‚úèÔ∏è</button>
                        </h2>
                        <form id="clienteForm">
                            <div class="form-group"><label for="id">ID de llamada</label><input id="id" name="id" type="text" placeholder="ID de la llamada"/></div>
                            <div class="form-group"><label for="nombreCliente">Nombre del contacto</label><input id="nombreCliente" name="nombreCliente" type="text" placeholder="Nombre del Cliente"/></div>
                            <div class="form-group"><label for="numeroInconveniente">N¬∞ Incidencia</label><input id="numeroInconveniente" name="numeroInconveniente" type="text" placeholder="N√∫mero del Inconveniente"/></div>
                            <div class="form-group"><label for="Inconveniente">Inconveniente</label><input id="Inconveniente" name="Inconveniente" type="text" placeholder="Inconveniente"/></div>
                            <div class="form-group"><label for="tipoServicio">Tipo Servicio</label><input id="tipoServicio" name="tipoServicio" type="text" placeholder="Tipo de Servicio"/></div>
                            <div class="form-group"><label for="pruebasRealizadas">PRUEBAS REALIZADAS</label><textarea id="pruebasRealizadas" name="pruebasRealizadas" placeholder="Las pruebas seleccionadas aparecer√°n aqu√≠"></textarea></div>
                            <div class="form-group button-group left-align">
                                <button id="copyButton" type="button" class="button">Copiar Plantilla</button>
                                <button id="clearGenericFormButton" type="button" class="button clear-button">Limpiar</button>
                            </div>
                        </form>
                    </div>
                    <div class="checkboxes-area-tab">
                        <div class="checkbox-group draggable-box" id="checkbox-group-nivelCero" data-group-id="nivelCero">
                            <h3 class="drag-handle">
                                <span>Nivel Cero:</span>
                                <button type="button" class="edit-title-btn" onclick="editBoxTitle(this.closest('.drag-handle').querySelector('span'))">‚úèÔ∏è</button>
                            </h3>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Saldos OK"/> Saldos OK</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="No hay Fallas"/> Fallas</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="No presenta bloqueo"/> Bloqueos</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="No hay OS abiertas"/> Ordenes Servicio</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="No hay quejas"/> Quejas</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="add-item-btn-container"><button type="button" class="manage-button" onclick="addCheckboxItem(this.closest('.checkbox-group'))">Agregar Checkbox</button></div>
                        </div>
                        <div class="checkbox-group draggable-box" id="checkbox-group-gponAdslHfc" data-group-id="gponAdslHfc">
                            <h3 class="drag-handle">
                                <span>GPON - ADSL - HFC</span>
                                <button type="button" class="edit-title-btn" onclick="editBoxTitle(this.closest('.drag-handle').querySelector('span'))">‚úèÔ∏è</button>
                            </h3>
                             <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se verifica estado de las luces del router"/> Luces router</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Envio reset en UMP"/> Reset en UMP</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se Desconecta y Conecta Corriente"/> Conexiones Fisicas</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se Desconecta y Conecta en otro tomacorriente"/> Otro Tomacorriente</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se verifica Splitter"/> Conexiones Splitter</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Cambio de bater√≠as"/> Cambio de bater√≠as</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se verifica Coaxial bien apretado"/> Conexiones Coaxial</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se verifica cortes o da√±os en la fibra"/> Conexiones Fibra Optica</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se manda a realizar test de velocidad (00 Megas)"/> Test de velocidad</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se realiza Ping (0% perdido)"/> Ping</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Estado de la ONT activo"/> Estado de la ONT</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Niveles SNR en Rojo"/> Niveles SNR Rojo</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Luz LOS en ROJO"/> Luz LOS en Rojo</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se envia reboot en Axiros"/> Reset en Axiros</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="add-item-btn-container"><button type="button" class="manage-button" onclick="addCheckboxItem(this.closest('.checkbox-group'))">Agregar Checkbox</button></div>
                        </div>
                         <div class="checkbox-group draggable-box" id="checkbox-group-tvHfcDthIptv" data-group-id="tvHfcDthIptv">
                            <h3 class="drag-handle">
                                <span>TV HFC - DTH - IPTV</span>
                                <button type="button" class="edit-title-btn" onclick="editBoxTitle(this.closest('.drag-handle').querySelector('span'))">‚úèÔ∏è</button>
                            </h3>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se verifica Conexiones HDMI"/> Conexion HDMI</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se Verifica Conexiones RCA"/> Conexion RCA</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se verifica cable Coaxial"/> Cable Coaxial</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="XX Stb afectados"/> Stb afectados </label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se valida Serial No. XXXX"/> Serial STB</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Mensaje que muestra Tv: XXX"/> Mensaje que muestra Tv</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se Envia Comando XXXX"/> Comandos enviados</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se Envia Reset Fisico"/> Reset Fisico</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se verifica en la GUI, AMCO en verde"/> AMCO en verde</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="add-item-btn-container"><button type="button" class="manage-button" onclick="addCheckboxItem(this.closest('.checkbox-group'))">Agregar Checkbox</button></div>
                        </div>
                         <div class="checkbox-group draggable-box" id="checkbox-group-otrosChecks" data-group-id="otrosChecks">
                            <h3 class="drag-handle">
                                <span>Otros</span>
                                <button type="button" class="edit-title-btn" onclick="editBoxTitle(this.closest('.drag-handle').querySelector('span'))">‚úèÔ∏è</button>
                            </h3>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se valida DPI ok, nombre completo ok, sin restricciones"/> Se valida titularidad</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Cliente no esta en Sitio"/> Cliente no esta en sitio</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Cliente esta en Agencia"/> Cliente en Agencia</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Cliente no quiere hacer pruebas"/> Cliente no quiere hacer pruebas</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se realiza cambio de contrase√±a con exito"/> Cambio de contrase√±a</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Servicio funcionando de manera correcta"/>Soporte Efectivo</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se Genera Averia"/>Se genera averia</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se env√≠a reproceso"/> Se env√≠a reproceso</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="add-item-btn-container"><button type="button" class="manage-button" onclick="addCheckboxItem(this.closest('.checkbox-group'))">Agregar Checkbox</button></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab2" class="tab-content">
                <div class="main-container-tab">
                    <div class="memos-config-area draggable-box" id="memos-config-area-tab2">
                        <h5 class="drag-handle">
                            <span>Memos de Quejas</span>
                            <button type="button" class="edit-title-btn" onclick="editBoxTitle(this.closest('.drag-handle').querySelector('span'))">‚úèÔ∏è</button>
                        </h5>
                        <div class="dropdown-container">
                            <select class="dropdown" id="opcionesMemoQuejas">
                                <option disabled selected value="">-- Seleccione Tipo de Memo --</option>
                                <option value="INTERNET DSL">INTERNET DSL</option>
                                <option value="TV DTH">TV DTH</option>
                                <option value="TV HFC">TV HFC</option>
                                <option value="INTERNET HFC/LINEA">INTERNET HFC</option>
                                <option value="LINEA FIJA">LINEA FIJA</option>
                                <option value="GPON/LINEA">GPON</option>
                                <option value="IPTV">IPTV</option>
                            </select>
                            <div id="formContainerMemoQuejas"></div>
                            <div class="add-item-btn-container" style="margin-top: 10px; text-align:right;">
                                <button type="button" id="addMemoFieldBtn" class="manage-button" style="display:none;">Agregar Campo</button>
                            </div>
                            <div class="button-group" style="margin-top: 20px;">
                                <button id="copyMemoQuejaButton" style="display: none;" class="button">Copiar Memo</button>
                                <button id="clearMemoQuejaButton" style="display: none;" class="button clear-button">Limpiar Memo</button>
                            </div>
                        </div>
                    </div>
                    <div class="checkboxes-area-tab">
                        <div class="checkbox-group draggable-box" id="checkbox-group-memoNivelCero" data-group-id="memoNivelCero">
                            <h3 class="drag-handle">
                                <span>Nivel Cero (Memos):</span>
                                <button type="button" class="edit-title-btn" onclick="editBoxTitle(this.closest('.drag-handle').querySelector('span'))">‚úèÔ∏è</button>
                            </h3>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Saldos OK"/> Saldos OK</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="No hay Fallas"/> Fallas</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="No presenta bloqueo"/> Bloqueos</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="No hay OS abiertas"/> Ordenes Servicio</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="No hay quejas"/> Quejas</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="add-item-btn-container"><button type="button" class="manage-button" onclick="addCheckboxItem(this.closest('.checkbox-group'))">Agregar Checkbox</button></div>
                        </div>
                        <div class="checkbox-group draggable-box" id="checkbox-group-memoGponAdslHfc" data-group-id="memoGponAdslHfc">
                            <h3 class="drag-handle">
                                <span>GPON - ADSL - HFC (Memos):</span>
                                <button type="button" class="edit-title-btn" onclick="editBoxTitle(this.closest('.drag-handle').querySelector('span'))">‚úèÔ∏è</button>
                            </h3>
                             <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se verifica estado de las luces del router"/> Luces router</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Envio reset en UMP"/> Reset en UMP</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se Desconecta y Conecta Corriente"/> Conexiones Fisicas</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se Desconecta y Conecta en otro tomacorriente"/> Otro Tomacorriente</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se verifica Splitter"/> Conexiones Splitter</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Cambio de bater√≠as"/> Cambio de bater√≠as</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se verifica Coaxial bien apretado"/> Conexiones Coaxial</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se verifica cortes o da√±os en la fibra"/> Conexiones Fibra Optica</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se manda a realizar test de velocidad (00 Megas)"/> Test de velocidad</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se realiza Ping (0% perdido)"/> Ping</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Estado de la ONT activo"/> Estado de la ONT</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Niveles SNR en Rojo"/> Niveles SNR Rojo</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Luz LOS en ROJO"/> Luz LOS en Rojo</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se envia reboot en Axiros"/> Reset en Axiros</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="add-item-btn-container"><button type="button" class="manage-button" onclick="addCheckboxItem(this.closest('.checkbox-group'))">Agregar Checkbox</button></div>
                        </div>
                         <div class="checkbox-group draggable-box" id="checkbox-group-memoTvHfcDthIptv" data-group-id="memoTvHfcDthIptv">
                            <h3 class="drag-handle">
                                <span>TV HFC - DTH - IPTV (Memos)</span>
                                <button type="button" class="edit-title-btn" onclick="editBoxTitle(this.closest('.drag-handle').querySelector('span'))">‚úèÔ∏è</button>
                            </h3>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se verifica Conexiones HDMI"/> Conexion HDMI</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se Verifica Conexiones RCA"/> Conexion RCA</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se verifica cable Coaxial"/> Cable Coaxial</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="XX Stb afectados"/> Stb afectados </label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se valida Serial No. XXXX"/> Serial STB</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Mensaje que muestra Tv: XXX"/> Mensaje que muestra Tv</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se Envia Comando XXXX"/> Comandos enviados</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se Envia Reset Fisico"/> Reset Fisico</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se verifica en la GUI, AMCO en verde"/> AMCO en verde</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="add-item-btn-container"><button type="button" class="manage-button" onclick="addCheckboxItem(this.closest('.checkbox-group'))">Agregar Checkbox</button></div>
                        </div>
                         <div class="checkbox-group draggable-box" id="checkbox-group-memoOtrosChecks" data-group-id="memoOtrosChecks">
                            <h3 class="drag-handle">
                                <span>Otros (Memos)</span>
                                <button type="button" class="edit-title-btn" onclick="editBoxTitle(this.closest('.drag-handle').querySelector('span'))">‚úèÔ∏è</button>
                            </h3>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se valida DPI ok, nombre completo ok, sin restricciones"/> Se valida titularidad</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Cliente no esta en Sitio"/> Cliente no esta en sitio</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Cliente esta en Agencia"/> Cliente en Agencia</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Cliente no quiere hacer pruebas"/> Cliente no quiere hacer pruebas</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se realiza cambio de contrase√±a con exito"/> Cambio de contrase√±a</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Servicio funcionando de manera correcta"/>Soporte Efectivo</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se Genera Averia"/>Se genera averia</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="checkbox-item-container" data-default="true"><label><input type="checkbox" value="Se env√≠a reproceso"/> Se env√≠a reproceso</label><button type="button" class="manage-button remove-item" onclick="removeCheckboxItem(this)">X</button></div>
                            <div class="add-item-btn-container"><button type="button" class="manage-button" onclick="addCheckboxItem(this.closest('.checkbox-group'))">Agregar Checkbox</button></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab3" class="tab-content">
                 <div class="main-container-tab">
                    <div class="wf-config-area draggable-box" id="wf-config-area-tab3">
                        <h5 class="drag-handle">
                            <span>Plantillas WF - Reparaci√≥n</span>
                            <button type="button" class="edit-title-btn" onclick="editBoxTitle(this.closest('.drag-handle').querySelector('span'))">‚úèÔ∏è</button>
                        </h5>
                        <div class="dropdown-container">
                            <select class="dropdown" id="wfDropdown">
                                <option selected disabled value="">-- Seleccione Plantilla WF --</option>
                            </select>
                            <textarea id="notaswfTextarea" placeholder="La plantilla seleccionada aparecer√° aqu√≠..." style="height: 180px; margin-top:15px; border-radius:10px;"></textarea>
                             <div style="margin-top:15px; display:flex; justify-content:flex-end; gap:10px;">
                                <button id="addWfTemplateBtn" type="button" class="manage-button">Nueva</button>
                                <button id="editWfTemplateBtn" type="button" class="manage-button" style="background-color: #FFC107;">Editar</button>
                                <button id="removeWfTemplateBtn" type="button" class="manage-button remove-item">Eliminar</button>
                            </div>
                            <div class="button-group" style="margin-top:20px;">
                                <button id="copyTextareawf" class="button">Copiar Plantilla WF</button>
                                <button id="clearWfTemplateButton" class="button clear-button">Limpiar WF</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab4" class="tab-content">
                <div class="transfers-container draggable-box" id="transfers-container-tab4" style="max-width: 700px; margin: auto;">
                    <h5 class="drag-handle">
                        <span>Transferencias</span>
                        <button type="button" class="edit-title-btn" onclick="editBoxTitle(this.closest('.drag-handle').querySelector('span'))">‚úèÔ∏è</button>
                    </h5>
                     <div id="dynamicTransfersList" class="transfers-list">
                        </div>
                    <div class="add-item-btn-container" style="margin-top: 15px; text-align: right;">
                        <button type="button" class="manage-button" id="addTransferBtn">Agregar Transferencia</button>
                    </div>
                </div>
            </div>

            <div id="tab5" class="tab-content">
                 <div class="backup-template-group draggable-box" id="backup-template-group-tab5" style="max-width: 900px; margin: auto;">
                    <h3 class="drag-handle">
                        <span>Plantillas Guardadas</span>
                        <button type="button" class="edit-title-btn" onclick="editBoxTitle(this.closest('.drag-handle').querySelector('span'))">‚úèÔ∏è</button>
                    </h3>
                    <textarea id="backupTemplatesTextarea" placeholder="Aqu√≠ se guardar√°n las plantillas copiadas como respaldo general..." style="min-height:250px;"></textarea>
                    <div class="button-group left-align">
                        <button id="copyBackupButton" type="button" class="button">Copiar Respaldo</button>
                        <button id="clearBackupButton" type="button" class="button clear-button">Limpiar Respaldo</button>
                    </div>
                </div>
            </div>

            <!-- New Tab Content for TMO Calculator -->
            <div id="tab6" class="tab-content">
                <div class="main-container-tab">
                    <div id="tmoMessageBox">
                        META TMO 372 SEGUNDOS COMO M√ÅXIMO!
                    </div>

                    <div id="minutesToSecondsConverter">
                        <h3>Calculadora de TMO</h3>
                        <div class="form-group">
                            <label for="minutesInput">Minutos</label>
                            <input type="number" id="minutesInput" placeholder="Ingrese minutos" min="0" step="any">
                        </div>
                        <button id="convertBtn" class="button">Convertir</button>
                        <div id="secondsResult">0 Segundos</div>
                    </div>
                </div>
            </div>
            <!-- End New Tab Content -->

            <!-- New Tab Content for Avisos (from recuadros.html) -->
            <div id="tab7" class="tab-content">
                <div class="main-container-tab" id="tab7-main-container">
                   <!-- El recuadro de "Avisos Importantes" ha sido eliminado de aqu√≠ -->

                    <!-- Recuadro de PROCESOS DE MIGRACI√ìN -->
                    <div class="document-viewer-box draggable-box" id="documentViewer1">
                        <h3 class="drag-handle">
                            <span>DOCUMENTO ADICIONAL 1</span>
                            <button type="button" class="edit-title-btn" onclick="editBoxTitle(this.closest('.drag-handle').querySelector('span'))">‚úèÔ∏è</button>
                        </h3>
                        <div class="document-iframe-container">
                            <iframe id="docIframe1" src="" style="width: 100%; height: 100%; border: none; border-radius: 8px;"
                                    onerror="this.style.display='none'; this.parentNode.innerHTML += '<div class=\'iframe-error-message\'>No se pudo cargar el documento. Verifique los permisos o el enlace.</div>'"></iframe>
                        </div>
                        <div style="text-align: center; margin-top: 10px;">
                            <button class="button" onclick="loadDocumentInIframe('docIframe1', 'https://docs.google.com/document/d/e/2PACX-1vQFB8P2uXmgPZ-5j9oz_AVKAIJrm19U1yYzy6X0H7hLXULAzYFga-91a4n3bZ6CKckEUHbFinufXjq2/pub?embedded=true')">Cargar PROCESOS DE MIGRACI√ìN (WF)</button>
                        </div>
                    </div>

                    <!-- Recuadro de documento 2 -->
                    <div class="document-viewer-box draggable-box" id="documentViewer2">
                        <h3 class="drag-handle">
                            <span>DOCUMENTO ADICIONAL 2</span>
                            <button type="button" class="edit-title-btn" onclick="editBoxTitle(this.closest('.drag-handle').querySelector('span'))">‚úèÔ∏è</button>
                        </h3>
                        <div class="document-iframe-container">
                            <iframe id="docIframe2" src="" style="width: 100%; height: 100%; border: none; border-radius: 8px;"
                                    onerror="this.style.display='none'; this.parentNode.innerHTML += '<div class=\'iframe-error-message\'>No se pudo cargar el documento. Verifique los permisos o el enlace.</div>'"></iframe>
                        </div>
                        <div style="text-align: center; margin-top: 10px;">
                            <button class="button" onclick="loadDocumentInIframe('docIframe2', 'https://docs.google.com/document/d/e/2PACX-1vQFB8P2uXmgPZ-5j9oz_AVKAIJrm19U1yYzy6X0H7hLXULAzYFga-91a4n3bZ6CKckEUHbFinufXjq2/pub?embedded=true')">Cargar Documento 2 (DOC)</button>
                        </div>
                    </div>

                    <!-- Los recuadros de documento 3 y los recuadros din√°micos han sido eliminados de aqu√≠ -->
                </div>
            </div>
            <!-- End New Tab Content for Avisos -->

        </div>

        <div class="firma-keiner"><strong>Desarrollado por: Keiner Valera.</strong></div>
    </div>

    <div id="bottomWidgetsContainer">
        <button id="toggleNotes" class="widget-toggle-button" title="Notas R√°pidas">üìù</button>
        <button id="toggleCopilot" class="widget-toggle-button" title="Copilot Chat">üí¨</button>
        <button id="toggleAddBox" class="widget-toggle-button" title="Agregar Recuadro">‚ûï</button>
        <button id="toggleTheme" class="widget-toggle-button" title="Personalizar Tema">üé®</button>
    </div>

    <div id="notesWidget" class="widget-panel">
        <div class="widget-header">Notas R√°pidas</div>
        <textarea id="notesArea" placeholder="Escribe tus notas aqu√≠..."></textarea>
        <div class="button-group-notes">
            <button id="copyNotesButton" class="button">Copiar</button>
            <button id="clearNotesButton" class="button clear-button">Limpiar</button>
        </div>
    </div>

    <div id="copilotWidget" class="widget-panel">
        <iframe src="https://copilotstudio.microsoft.com/environments/Default-35058e0b-9a5c-4d1c-aa8e-08d02cd58b1a/bots/cr32d_marketingDigitalPro/webchat?__version__=2" title="Chatbot Copilot"></iframe>
    </div>

    <div id="addBoxWidget" class="widget-panel">
        <div class="widget-header">Agregar Recuadro</div>
        <p style="text-align: center; margin-bottom: 15px; color: var(--texto-intermedio);">Agrega un nuevo recuadro a la pesta√±a actual.</p>
        <button id="addBoxToActiveTabBtn" class="button" style="width: 100%;">Agregar Recuadro</button>
    </div>

    <div id="themeWidgetPanel" class="widget-panel">
        <div class="widget-header">Personalizar Tema</div>
        <div class="theme-color-group">
            <label for="themeColorPrimary">Color Primario (ej. Azul Oscuro):</label>
            <input type="color" id="themeColorPrimary" data-css-var="--azul-oscuro">
        </div>
        <div class="theme-color-group">
            <label for="themeColorSecondary">Color Secundario (ej. Morado):</label>
            <input type="color" id="themeColorSecondary" data-css-var="--morado">
        </div>
        <div class="theme-color-group">
            <label for="themeColorAccent">Color Acento (ej. Turquesa):</label>
            <input type="color" id="themeColorAccent" data-css-var="--turquesa">
        </div>
        <div class="theme-color-group">
            <label for="themeColorBackground">Color Fondo Principal:</label>
            <input type="color" id="themeColorBackground" data-css-var="--gris-claro">
        </div>
        <div class="theme-color-group">
            <label for="themeColorTextDark">Color Texto Principal (Oscuro):</label>
            <input type="color" id="themeColorTextDark" data-css-var="--texto-oscuro">
        </div>
        <div class="theme-color-group">
            <label for="themeColorNeuron1">Neurona Color 1:</label>
            <input type="color" id="themeColorNeuron1" data-neuron-var="--neuron-color-1-rgb">
        </div>
        <div class="theme-color-group">
            <label for="themeColorNeuron2">Neurona Color 2:</label>
            <input type="color" id="themeColorNeuron2" data-neuron-var="--neuron-color-2-rgb">
        </div>
        <div class="theme-color-group">
            <label for="themeColorNeuron3">Neurona Color 3:</label>
            <input type="color" id="themeColorNeuron3" data-neuron-var="--neuron-color-3-rgb">
        </div>
        <div class="theme-color-group">
            <label for="themeColorNeuronConnection">Conexi√≥n Neuronas:</label>
            <input type="color" id="themeColorNeuronConnection" data-neuron-var="--neuron-connection-rgb">
        </div>
        <div class="button-group-theme">
            <button id="applyThemeBtn" class="button">Aplicar</button>
            <button id="resetThemeBtn" class="button clear-button">Restaurar</button>
        </div>
    </div>

    <!-- Modal de Aviso Importante -->
    <div id="importantNoticeModal" class="popup-modal">
        <div class="popup-content">
            <h2>¬°AVISO IMPORTANTE!</h2>
            <p>Ahora Omega presenta su nueva pesta√±a de AVISOS, la cual tiene como finalidad mostrar aquellos documentos importantes que est√°n en circuito en operaci√≥n como por ejemplo: word de migraci√≥n y WF para seguimiento de ordenes!</p>
            <button id="closeNoticeModalBtn" class="popup-close-btn">Entendido</button>
        </div>
    </div>


    <script>
    // Estructura de plantillas WF predefinidas (ahora global)
    const defaultWfTemplates = {
        "OS CABLEADO ETHERNET": `ASUNTO...............: INSTALACI√ìN + DESCRIPCI√ìN\nNUMERO DE SERVICIO......:\nNOMBRE DE TITULAR....:\nDPI TITULAR..........: DPI\nTELEFONO REFERENCIA. :\nDIRECCI√ìN INSTALACI√ìN:\nHORARIO DE VISITA....:\nOBSERVACIONES........:\nTIENDA / CALL CENTER`,
        "plantilla orden CG": `ASUNTO...............: INSTALACI√ìN + DESCRIPCI√ìN\nNUMERO DE SERVICIO......:\nNOMBRE DE TITULAR....: \nDPI TITULAR..........: DPI \nTELEFONO REFERENCIA. : \nDIRECCI√ìN INSTALACI√ìN: \nHORARIO DE VISITA....: \nOBSERVACIONES........: \nTIENDA / CALL CENTER`,
        "migracion gpon": `Tipo de reporte Migraci√≥n a Gpon \nAcepta migraci√≥n \nFactura Con: \nTitular del servicio \nContacto en sitio \nNo. Contacto \nDirecci√≥n \nHorario de visita \nComentario`,
        "INCONVENIENTES CON VPN": `NUMERO DE SERVICIO......:\nTipo de CPE:\nMAC Cable Modem o CPE:\nProblema reportado:Filtrado Mac / Conexion VPN\nNombre del cliente:\nTel Contacto:\nNombre completo herramienta o aplicativo de vpn:\nPuertos UDP y TCP que desee verificar:\nNumero o nombre de error que da el aplicativo:\nSi es VPN, hac√≠a que IP intenta conectarse:\nMAC Address de la computadora:\nPruebas(si se efect√∫an):\nComentario:\n\nQuien genera queja Telef√≥nico\n Luz Pon \n Luz Los \n Serie \nCanal da√±ado \nProblema reportado \nPruebas Realizadas \nContacto en sitio \nTel√©fonos de referencias \nHorario de visita \nDirecci√≥n`,
        "FILTRADO MAC": `Problema reportado:Filtrado Mac:\nN√∫mero de Servicio::::::\nNombre del cliente::::::\nTel Contacto::::::::::::\nMAC Address:::::::::::::\nPruebas(si se efect√∫an):N/A\nComentario::::::::::::::`,
        "CITA INCUMPLIDA": `No. Orden.:\nNombre contacto:\nNumero de referencia:\nFecha de visita:\nHora de visita:\nGestor de Despacho que atendi√≥ la llamada:\n\nOrden:\ntipo de orden:\ntecnolog√≠a:\nRegi√≥n:\nfecha de nueva visita:\nhorario am/pm:\nNombre de cliente:\nDescripci√≥n: ej: negociamos nueva visita con cl, d√≠a 12/02/2025....  o si no se negoci√≥, indiquen que se escal√≥ por WhatsApp para el mismo d√≠a.`,
        "VENCIDO COMERCIAL": `Tel√©fono de referencia..................:\nNo. de O/S..............................:\nComentarios.............................:\nHora visita.............................: (Aplica si fuera cita incumplida)`,
        "VELOCIDAD MAL CONFIGURADA":
`No. Contacto:
\nInconveniente reportado:VELOCIDAD MAL CONFIGURADA
\nVirtual Reportado:...........:
\nVelocidad Config PISA:.............:
\nVelocidad config UMP:`,
        "VENCIDO OPERACIONES": `Tel√©fono de referencia:\nNo. de O/S............:\nComentarios...........:\nNo. Queja.............:(Si aplica)\nHora visita...........:(Aplica si fuera cita incumplida)\nPruebas Realizadas....:(Aplica si es reparaci√≥n)`,
        "LOCUCI√ìN MORA ACTIVA": `Nombre de quien reporta:\nN√∫mero afectado........:\nTel de Ref.............:\nO/S generada...........: Ampliaci√≥n de l√≠mite\nFecha de pago..........:\nIVR....................: IVR / llaman de cobros\nObservaciones..........:`,
        "DEVOLUCI√ìN DE LLAMADA": `Nombre del cliente que visita:\nN√∫mero afectado o virtual:\nN√∫meros de contacto:\nServicio y problema Reportado;\nSaldos:(Ok)\nHorario de contacto:(MA√ëANA|TARDE|NOCHE)`,
        "DA√ëO A LA INFRAESTRUTURA": `Contacto:\nTel√©fono de contacto:\nDirecci√≥n de da√±o:\nDa√±o que reporta:`,
        "RECONEXI√ìN WF": `Tel√©fono de referencia..:\nNo. de O/S..............:\nComentarios.............:`,
        "PAQUETE DE CANALES WF": `ASUNTO................... (No observa paquetes de Canales)\nNOMBRE DE TITULAR........\nTEL. REF.................\nPAQUETE..................\nNUMERO DE SET TOP BOX.... Serie STB\nOBSERVACIONES............\nNUMERO DE CANALES........`,
        "SERVICIO DIGITALES": `Numero de Servicio Afectado...:\nCliente.......................:\nTel√©fonos de referencia.......:\nServicio Digital con Problemas:\nDescripci√≥n del caso..........:`,
        "CAMBIO DE ACTUALIZACI√ìN MAC EN IP PUBLICA HFC": `Mac del modem..........................:\nVirtual de cliente (Con el que factura):\nNombre del cliente.....................:\nIp Publica asociada....................:\nMac Actual.............................:\nNueva Mac..............................:\nNo. de Contacto....................:`,
        "CLARO VIDEO": `Nombre del Cliente:::\nN√∫mero telef√≥nico::::\nCorreo electr√≥nico a registrar:::\nQu√© problema reporta:::\nFecha de nacimiento:::\nTelefonos de contacto:::\nPlataforma donde est√° tratando de registrarse (Claro Video).`,
        "OTROS WF": `Nombre de contacto:::::::::\nTelefonos de referencia:::\nNumero de orden y/o queja:\nInconveniente del cliente:\nPruebas Realizada:::::::::`,
        "Bloqueo mayor a 2 horas": `Nombre de quien reporta:\nServicio a liberar.....:\nNo. afectado...........:\nTipo de bloqueo........:\nTel de Ref.............:\nHora de Pago...........:\nReincidente............:\nComentarios............: cl al d√≠a, realizo el pago hace m√°s de dos horas y a√∫n sigue bloqueado`,
        "Reparaci√≥n en tiempo vigente WF": `Tel√©fono de referencia:\nNo. de O/S............:\nComentarios...........: Seguimiento a queja en tiempo Vigente\nNo. Queja.............:\nHora visita...........:8:00 a 5:00\nPruebas Realizadas....: Cl Indica que no le han llegado a reparar el servicio y le urge, por favor verificar`,
        "Reparaci√≥n en tiempo vencido WF": `Tel√©fono de referencia:\nNo. de O/S............:\nComentarios...........: Cliente solicita reparaci√≥n en tiempo vencido\nNo. Queja.............:\nHora visita...........:8:00 a 5:00\nPruebas Realizadas....:`,
        "MALA ATENCION DEL TECNICO": `Motivo:::::::::::::::::::::: Mala atencion del tecnico\nN√∫mero afectado:::::::::::::\nNombre completo del cliente:\nNombre de quien reporta:::::\nTel√©fono de referencia::::::\nFecha de solicitud::::::::::\nServicio contratado:::::::::\nDirecci√≥n de instalaci√≥n::::\nDescripci√≥n del reclamo:::::`,
        "MIGRACION DE SERVICIOS": `Tipo de reporte:\nAcepta migrar:\nNo. factura con:\nTitular del servicio:\nContacto en sitio:\nTel. de contacto:\nDirecci√≥n:\nHorario de visita:\nComentario:`,
        "CHECK EN ROJO PAGINA DE SOPORTE WF": `N√∫mero:\nCorreo Claro Video:\nPlan o paquete contratado:\nCheck con error en GUI: AMCO, PLE, Ambos\nN√∫mero de contacto:\nCliente:\nDescripci√≥n:\nPruebas realizadas:`,
        "Asignaci√≥n en p√°gina de soporte": `N√∫mero:\nCorreo Claro Video:\nPlan o paquete contratado:\nPaquete IPTV que deber√≠a asignarse en GUI:\nN√∫mero de contacto:\nCliente:\nDescripci√≥n:\nPruebas realizadas:`,
        "Sin acceso a guia*interactiva WF": `N√∫mero:\nCorreo Claro Video:\nPlan o paquete contratado:\nCheck AMCO y PLE : Ambos en verde\nMensaje que muestra TV:\nN√∫mero de contacto:\nCliente:\nDescripci√≥n:\nPruebas realizadas:`,
        "CONFIGURACION WIFI": `Quien genera queja\n Luz Pon\n Luz Los\n Serie\nCanal da√±ado\nProblema reportado\nPruebas Realizadas\nContacto en sitio\nTel√©fonos de referencias\nHorario de visita\nDirecci√≥n`
    };

    document.addEventListener('DOMContentLoaded', function () {
        // --- GLOBAL ELEMENTS ---
        const landingPage = document.getElementById('landingPage');
        const mainContentPage = document.getElementById('mainContentPage');
        const siguienteBtn = document.getElementById('siguienteBtn');
        const backupTemplatesTextarea = document.getElementById('backupTemplatesTextarea'); 

        // --- THEME WIDGET ELEMENTS ---
        const themeWidgetPanel = document.getElementById('themeWidgetPanel');
        const toggleThemeButton = document.getElementById('toggleTheme');
        const applyThemeBtn = document.getElementById('applyThemeBtn');
        const resetThemeBtn = document.getElementById('resetThemeBtn');
        const themeColorInputs = [
            { id: 'themeColorPrimary', cssVar: '--azul-oscuro', type: 'css' },
            { id: 'themeColorSecondary', cssVar: '--morado', type: 'css' },
            { id: 'themeColorAccent', cssVar: '--turquesa', type: 'css' },
            { id: 'themeColorBackground', cssVar: '--gris-claro', type: 'css' },
            { id: 'themeColorTextDark', cssVar: '--texto-oscuro', type: 'css' },
            { id: 'themeColorNeuron1', neuronVar: '--neuron-color-1-rgb', type: 'neuron' },
            { id: 'themeColorNeuron2', neuronVar: '--neuron-color-2-rgb', type: 'neuron' },
            { id: 'themeColorNeuron3', neuronVar: '--neuron-color-3-rgb', type: 'neuron' },
            { id: 'themeColorNeuronConnection', neuronVar: '--neuron-connection-rgb', type: 'neuron' }
        ];
        
        // Default theme values (ensure these match the :root in CSS)
        const defaultThemeSettings = {
            '--azul-oscuro': "#1A237E",
            '--morado': "#6A1B9A",
            '--turquesa': "#00BCD4",
            '--gris-claro': "#F0F0F0",
            '--blanco': "#FFFFFF", // Blanco no es personalizable directamente aqu√≠, pero es parte del tema
            '--texto-oscuro': "#333333",
            '--texto-intermedio': "#555555",
            '--texto-claro': "#CCCCCC",
            '--rojo-claro': "#e74c3c",
            '--rojo-oscuro': "#c0392b",
            '--verde-claro': "#28a745",
            '--verde-oscuro': "#218838",
            /* Neuron RGB parts */
            '--neuron-color-1-rgb': "106, 27, 154",
            '--neuron-color-2-rgb': "0, 188, 212",
            '--neuron-color-3-rgb': "26, 35, 126",
            '--neuron-connection-rgb': "106, 27, 154"
        };


        // --- BOTTOM WIDGETS ---
        const bottomWidgetsContainer = document.getElementById('bottomWidgetsContainer');
        const notesWidget = document.getElementById('notesWidget');
        const copilotWidget = document.getElementById('copilotWidget');
        const addBoxWidget = document.getElementById('addBoxWidget'); 
        const allWidgetPanels = [notesWidget, copilotWidget, addBoxWidget, themeWidgetPanel]; // Added themeWidgetPanel
        let openWidgetPanel = null; 

        // --- LANDING PAGE ---
        if (siguienteBtn) {
            siguienteBtn.addEventListener('click', function () {
                if (landingPage) landingPage.style.display = 'none';
                if (mainContentPage) mainContentPage.style.display = 'block';
                if (bottomWidgetsContainer) bottomWidgetsContainer.style.display = 'flex';
                loadAllSavedData(); // Load all data on initial entry
                initializeDraggableElements(); 
                positionWidgetButtons(); 
                showImportantNoticeModal(); // Show the new modal after loading main content
            });
        }

        // --- TAB LOGIC ---
        const tabLinks = document.querySelectorAll('.tab-link');
        const tabContents = document.querySelectorAll('.tab-content');
        tabLinks.forEach(link => {
            link.addEventListener('click', () => {
                // Save the state of the currently active tab BEFORE switching
                saveAllCurrentData();

                // Perform the tab switching display logic
                tabLinks.forEach(l => l.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                link.classList.add('active');
                const tabId = link.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
                
                // Load the state for all tabs (including the newly active one) AFTER switching
                loadAllSavedData();

                // Re-initialize draggable elements for the new tab content
                initializeDraggableElements(); 

                // Special handling for Avisos tab
                if (tabId === 'tab7') {
                    // No longer calling renderHardcodedNotices() as it's removed
                }

                // The calls to actualizarPruebasRealizadas() and updateMemoPruebasRealizadas()
                // are now removed from here, as they would overwrite manual input.
                // They will only be triggered by individual checkbox changes.
            });
        });

        // --- NEURON ANIMATION ---
        let globalNeuronColorsRGB = [ // Store as RGB strings
            defaultThemeSettings['--neuron-color-1-rgb'],
            defaultThemeSettings['--neuron-color-2-rgb'],
            defaultThemeSettings['--neuron-color-3-rgb']
        ];
        let globalNeuronConnectionRGB = defaultThemeSettings['--neuron-connection-rgb'];


        (function() {
            const canvas = document.getElementById('neuronCanvas');
            if (!canvas) {
                console.error("Error: Canvas element #neuronCanvas not found for animation.");
                return;
            }
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            let particlesArray = [];

            class Particle {
                constructor(x, y, size, color, speedX, speedY) {
                    this.x = x; this.y = y; this.size = size; this.color = color;
                    this.speedX = speedX; this.speedY = speedY;
                }
                draw() {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                }
                update() {
                    if (this.x + this.size > canvas.width || this.x - this.size < 0) this.speedX = -this.speedX;
                    if (this.y + this.size > canvas.height || this.y - this.size < 0) this.speedY = -this.speedY;
                    this.x += this.speedX; this.y += this.speedY;
                    this.draw();
                }
            }

            window.init_particles = function() { // Made global for theme updates
                particlesArray = [];
                const numberOfParticles = (canvas.height * canvas.width) / 10000;
                for (let i = 0; i < numberOfParticles; i++) {
                    const size = Math.random() * 2.5 + 1.5;
                    const x = Math.random() * (innerWidth - size * 2) + size;
                    const y = Math.random() * (innerHeight - size * 2) + size;
                    const speedX = (Math.random() * 0.8) - 0.4;
                    const speedY = (Math.random() * 0.8) - 0.4;
                    // Use globalNeuronColorsRGB to construct rgba strings
                    const randomRgbString = globalNeuronColorsRGB[Math.floor(Math.random() * globalNeuronColorsRGB.length)];
                    const color = `rgba(${randomRgbString}, 0.7)`; // Add alpha
                    particlesArray.push(new Particle(x, y, size, color, speedX, speedY));
                }
            }

            function animate_particles() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particlesArray.forEach(particle => particle.update());
                connect_particles();
                requestAnimationFrame(animate_particles);
            }

            window.connect_particles = function() { // Made global for theme updates
                let opacityValue = 1;
                const connectionRgb = globalNeuronConnectionRGB; // Use the global variable
                for (let a = 0; a < particlesArray.length; a++) {
                    for (let b = a + 1; b < particlesArray.length; b++) {
                        let distance = Math.sqrt(((particlesArray[a].x - particlesArray[b].x) ** 2) + ((particlesArray[a].y - particlesArray[b].y) ** 2));
                        if (distance < (canvas.width / 100 * 12) ) {
                            opacityValue = 1 - (distance / (canvas.width / 100 * 12) );
                            ctx.strokeStyle = `rgba(${connectionRgb}, ${opacityValue * 0.4})`; 
                            ctx.lineWidth = 0.5;
                            ctx.beginPath();
                            ctx.moveTo(particlesArray[a].x, particlesArray[a].y);
                            ctx.lineTo(particlesArray[b].x, particlesArray[b].y);
                            ctx.stroke();
                        }
                    }
                }
            }
            init_particles();
            animate_particles();
            window.addEventListener('resize', () => {
                canvas.width = innerWidth; canvas.height = innerHeight;
                init_particles();
            });
        })();


        // --- BOTTOM WIDGETS LOGIC ---
        function positionWidgetButtons() {
            const widgetButtons = Array.from(bottomWidgetsContainer.children).filter(el => el.classList.contains('widget-toggle-button'));
            let currentRightOffset = 10; 

            widgetButtons.forEach(button => {
                button.style.right = `${currentRightOffset}px`;
                button.style.bottom = '10px'; 
                currentRightOffset += button.offsetWidth + 10; 
            });

            if (openWidgetPanel) {
                const associatedButton = document.querySelector(`[data-widget-id="${openWidgetPanel.id}"]`);
                if (associatedButton) {
                    const buttonRect = associatedButton.getBoundingClientRect();
                    openWidgetPanel.style.bottom = `${window.innerHeight - buttonRect.top + 10}px`;
                    openWidgetPanel.style.right = `${window.innerWidth - buttonRect.right}px`;
                }
            }
        }

        function toggleWidget(widgetToToggle, button) {
            const isAlreadyOpen = widgetToToggle === openWidgetPanel;

            if (openWidgetPanel) {
                openWidgetPanel.classList.remove('active-widget'); 
                const oldButton = document.querySelector(`[data-widget-id="${openWidgetPanel.id}"]`);
                 if(oldButton) {
                    oldButton.classList.remove('active-toggle');
                    if (oldButton.id === 'toggleCopilot') oldButton.textContent = 'üí¨';
                    else if (oldButton.id === 'toggleNotes') oldButton.textContent = 'üìù';
                    else if (oldButton.id === 'toggleAddBox') oldButton.textContent = '‚ûï'; 
                    else if (oldButton.id === 'toggleTheme') oldButton.textContent = 'üé®'; // Restore theme button
                 }
            }

            if (isAlreadyOpen) {
                openWidgetPanel = null; 
            } else {
                widgetToToggle.classList.add('active-widget'); 
                const buttonRect = button.getBoundingClientRect();
                widgetToToggle.style.bottom = `${window.innerHeight - buttonRect.top + 10}px`; 

                let panelRight = window.innerWidth - buttonRect.right;
                if (buttonRect.right < widgetToToggle.offsetWidth) { 
                    panelRight = 10; 
                }
                widgetToToggle.style.right = `${panelRight}px`;

                button.classList.add('active-toggle');
                button.textContent = '‚ùå'; 
                openWidgetPanel = widgetToToggle;
            }
        }
        
        document.getElementById('toggleNotes')?.addEventListener('click', function() { toggleWidget(notesWidget, this); });
        document.getElementById('toggleCopilot')?.addEventListener('click', function() { toggleWidget(copilotWidget, this); });
        document.getElementById('toggleAddBox')?.addEventListener('click', function() { toggleWidget(addBoxWidget, this); });
        toggleThemeButton?.addEventListener('click', function() { toggleWidget(themeWidgetPanel, this); }); // Listener for theme widget

        document.getElementById('toggleNotes')?.setAttribute('data-widget-id', 'notesWidget');
        document.getElementById('toggleCopilot')?.setAttribute('data-widget-id', 'copilotWidget');
        document.getElementById('toggleAddBox')?.setAttribute('data-widget-id', 'addBoxWidget');
        toggleThemeButton?.setAttribute('data-widget-id', 'themeWidgetPanel'); // Data-id for theme widget

        window.addEventListener('resize', positionWidgetButtons); 


        // --- THEME WIDGET LOGIC ---
        function hexToRgbString(hex) {
            let r = 0, g = 0, b = 0;
            if (hex.length == 4) { // #RGB
                r = "0x" + hex[1] + hex[1];
                g = "0x" + hex[2] + hex[2];
                b = "0x" + hex[3] + hex[3];
            } else if (hex.length == 7) { // #RRGGBB
                r = "0x" + hex[1] + hex[2];
                g = "0x" + hex[3] + hex[4];
                b = "0x" + hex[5] + hex[6];
            }
            return `${+r}, ${+g}, ${+b}`;
        }

        function rgbStringToHex(rgbString) {
            if (!rgbString || typeof rgbString !== 'string') return '#000000';
            const rgb = rgbString.split(',').map(Number);
            return "#" + ((1 << 24) + (rgb[0] << 16) + (rgb[1] << 8) + rgb[2]).toString(16).slice(1).toUpperCase();
        }
        
        function applyCurrentTheme() {
            themeColorInputs.forEach(inputConfig => {
                const inputElement = document.getElementById(inputConfig.id);
                if (inputElement) {
                    const colorValue = inputElement.value; // This is HEX from color picker
                    if (inputConfig.type === 'css') {
                        document.documentElement.style.setProperty(inputConfig.cssVar, colorValue);
                    } else if (inputConfig.type === 'neuron') {
                        const rgbString = hexToRgbString(colorValue);
                        document.documentElement.style.setProperty(inputConfig.neuronVar, rgbString);
                        // Update global JS arrays for neurons
                        if (inputConfig.neuronVar === '--neuron-color-1-rgb') globalNeuronColorsRGB[0] = rgbString;
                        else if (inputConfig.neuronVar === '--neuron-color-2-rgb') globalNeuronColorsRGB[1] = rgbString;
                        else if (inputConfig.neuronVar === '--neuron-color-3-rgb') globalNeuronColorsRGB[2] = rgbString;
                        else if (inputConfig.neuronVar === '--neuron-connection-rgb') globalNeuronConnectionRGB = rgbString;
                    }
                }
            });
            if (typeof init_particles === "function") init_particles(); // Redraw neurons
            // connect_particles will use the updated globalNeuronConnectionRGB via CSS var or direct access if needed
        }

        function resetThemeToDefaults() {
            for (const varName in defaultThemeSettings) {
                document.documentElement.style.setProperty(varName, defaultThemeSettings[varName]);
            }
            // Update global JS neuron color arrays from defaults
            globalNeuronColorsRGB = [
                defaultThemeSettings['--neuron-color-1-rgb'],
                defaultThemeSettings['--neuron-color-2-rgb'],
                defaultThemeSettings['--neuron-color-3-rgb']
            ];
            globalNeuronConnectionRGB = defaultThemeSettings['--neuron-connection-rgb'];

            initializeThemeWidget(); // Reset color pickers to default values
            createCustomAlert('Tema restaurado a los valores por defecto.');
        }

        function initializeThemeWidget() {
            themeColorInputs.forEach(inputConfig => {
                const inputElement = document.getElementById(inputConfig.id);
                if (inputElement) {
                    let currentValue;
                    if (inputConfig.type === 'css') {
                        currentValue = getComputedStyle(document.documentElement).getPropertyValue(inputConfig.cssVar).trim();
                    } else if (inputConfig.type === 'neuron') {
                        const rgbString = getComputedStyle(document.documentElement).getPropertyValue(inputConfig.neuronVar).trim();
                        currentValue = rgbStringToHex(rgbString);
                    }
                    inputElement.value = currentValue;
                }
            });
        }

        applyThemeBtn?.addEventListener('click', () => {
            applyCurrentTheme();
            createCustomAlert('Tema aplicado.');
        });
        resetThemeBtn?.addEventListener('click', resetThemeToDefaults);
        

        // --- TIMER (IN TOP BAR) ---
        // ... (Existing timer code, no changes needed for theme)
        const topTimerDisplay = document.getElementById('topTimerDisplay');
        const topTimerInputMinutes = document.getElementById('topTimerInputMinutes');
        const startTimerBtnTop = document.getElementById('startTimerBtnTop');
        const stopTimerBtnTop = document.getElementById('stopTimerBtnTop');
        const resetTimerBtnTop = document.getElementById('resetTimerBtnTop');
        let alarmSound = document.getElementById('alarmSound'); 

        let timerInterval;
        let totalSeconds = 0;
        let initialSetMinutes = 5;

        if (!alarmSound) {
            const audioEl = document.createElement('audio');
            audioEl.id = 'alarmSound';
            audioEl.src = 'MorningFlower.mp3'; 
            audioEl.preload = 'auto';
            document.body.appendChild(audioEl);
            alarmSound = audioEl; 
        }

        if (alarmSound) {
            alarmSound.volume = 0.5;
            alarmSound.load();
            alarmSound.onerror = () => {
                console.error("Error loading audio file. Check the path 'MorningFlower.mp3'.");
            };
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateTopTimerDisplay() {
            if (topTimerDisplay) topTimerDisplay.textContent = formatTime(totalSeconds);
        }

        function setInitialTimerValuesTop() {
            initialSetMinutes = parseInt(topTimerInputMinutes.value, 10) || 5;
            totalSeconds = initialSetMinutes * 60;
            updateTopTimerDisplay();
        }

        if (startTimerBtnTop) {
            startTimerBtnTop.addEventListener('click', () => {
                clearInterval(timerInterval);
                if (totalSeconds <= 0 || totalSeconds === (initialSetMinutes * 60)) {
                    const minutesFromInput = parseInt(topTimerInputMinutes.value, 10);
                    if (isNaN(minutesFromInput) || minutesFromInput <= 0) {
                        createCustomAlert("Please enter a valid time in minutes.");
                        return;
                    }
                    initialSetMinutes = minutesFromInput;
                    totalSeconds = initialSetMinutes * 60;
                }

                if(totalSeconds <= 0) return;

                updateTopTimerDisplay();

                if (alarmSound) {
                    alarmSound.play().then(() => {
                        alarmSound.pause();
                        alarmSound.currentTime = 0;
                    }).catch(e => {
                        console.warn("Warning: Failed to pre-play alarm (could be autoplay block, but final alarm should work if there's enough interaction). Error:", e);
                    });
                }

                timerInterval = setInterval(() => {
                    totalSeconds--;
                    updateTopTimerDisplay();
                    if (totalSeconds < 0) {
                        totalSeconds = 0;
                        updateTopTimerDisplay();
                        clearInterval(timerInterval);
                        if (alarmSound) {
                            alarmSound.play().catch(e => console.error("Error playing final alarm sound:", e));
                        }
                        createCustomAlert("Time's up!");
                    }
                }, 1000);
            });
        }

        if (stopTimerBtnTop) {
            stopTimerBtnTop.addEventListener('click', () => {
                clearInterval(timerInterval);
                if (alarmSound) alarmSound.pause();
            });
        }

        if (resetTimerBtnTop) {
            resetTimerBtnTop.addEventListener('click', () => {
                clearInterval(timerInterval);
                setInitialTimerValuesTop();
                if (alarmSound) {
                    alarmSound.pause();
                    alarmSound.currentTime = 0;
                }
            });
        }

        if(topTimerInputMinutes) {
            setInitialTimerValuesTop();
            topTimerInputMinutes.addEventListener('change', setInitialTimerValuesTop);
        }


        // --- QUICK NOTES (Widget) ---
        // ... (Existing notes code, no changes needed for theme)
        const notesArea = document.getElementById('notesArea');
        const copyNotesButton = document.getElementById('copyNotesButton');
        const clearNotesButton = document.getElementById('clearNotesButton');

        if (copyNotesButton && notesArea) {
            copyNotesButton.addEventListener('click', function() {
                if (notesArea.value) {
                    notesArea.select();
                    notesArea.setSelectionRange(0, 99999);
                    document.execCommand('copy'); 
                    createCustomAlert('Notes copied to clipboard.');
                } else {
                    createCustomAlert('No notes to copy.');
                }
            });
        }

        if (clearNotesButton && notesArea) {
            clearNotesButton.addEventListener('click', function() {
                createCustomConfirm('Are you sure you want to clear the notes?', () => {
                    notesArea.value = '';
                });
            });
        }


        // --- GENERIC TEMPLATE (TAB 1) ---
        // Se modific√≥ para incluir checkboxes de recuadros din√°micos
        window.actualizarPruebasRealizadas = function() {
            // Selecciona todos los checkboxes dentro de #tab1, incluyendo los de los recuadros din√°micos
            const checkboxes = document.querySelectorAll('#tab1 .checkbox-group input[type="checkbox"]');
            const pruebasRealizadasEl = document.getElementById('pruebasRealizadas');
            const seleccionados = [];

            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    let texto = checkbox.value ? checkbox.value.trim() : '';
                    if(texto) seleccionados.push(texto);
                }
            });

            if (pruebasRealizadasEl) {
                pruebasRealizadasEl.value = seleccionados.join(', ');
            }
        };
        const clearGenericForm = function() {
            document.getElementById('id').value = '';
            document.getElementById('nombreCliente').value = '';
            document.getElementById('numeroInconveniente').value = '';
            document.getElementById('Inconveniente').value = '';
            document.getElementById('tipoServicio').value = '';
            document.getElementById('pruebasRealizadas').value = '';
            document.querySelectorAll('#tab1 .checkbox-group input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            actualizarPruebasRealizadas();
        };
        document.getElementById('clearGenericFormButton')?.addEventListener('click', clearGenericForm);
        // Listener para checkboxes est√°ticos en Tab 1
        document.querySelectorAll('#tab1 .checkbox-group:not([data-is-dynamic="true"]) input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', actualizarPruebasRealizadas);
        });
        const copyButtonEl = document.getElementById('copyButton');
        if (copyButtonEl) {
            copyButtonEl.addEventListener('click', function () {
                const idVal = document.getElementById('id')?.value || '';
                const nombreClienteVal = document.getElementById('nombreCliente')?.value || '';
                const numeroInconvenienteVal = document.getElementById('numeroInconveniente')?.value || '';
                const tipoServicioVal = document.getElementById('tipoServicio')?.value || '';
                const pruebasRealizadasVal = document.getElementById('pruebasRealizadas')?.value || '';
                const InconvenienteVal = document.getElementById('Inconveniente')?.value || '';
                const contenido = `ID de llamada: ${idVal}\nNombre del contacto: ${nombreClienteVal}\nN¬∞ Incidencia: ${numeroInconvenienteVal}\nInconveniente: ${InconvenienteVal}\nTipo Servicio: ${tipoServicioVal}\n\nPRUEBAS REALIZADAS:\n${pruebasRealizadasVal}`;
                navigator.clipboard.writeText(contenido)
                    .then(() => {
                        createCustomAlert('Template content copied.');
                        if (backupTemplatesTextarea) {
                            const now = new Date();
                            const timestamp = `${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;
                            backupTemplatesTextarea.value += `--- Generic Template (${timestamp}) ---\n${contenido}\n\n`;
                        }
                    })
                    .catch(err => console.error('Error copying template:', err));
            });
        }


        // --- CHECKBOX DYNAMICS (General) ---
        // Se modific√≥ addCheckboxItem para adjuntar el listener de cambio correctamente
        window.addCheckboxItem = function(checkboxGroupElement, initialTitle = '', initialContent = '', isChecked = false) {
            let newItemTitle = initialTitle;
            let newItemContent = initialContent;

            // Determinar si se debe pedir al usuario los valores
            const isDynamicBox = checkboxGroupElement.closest('.draggable-box[data-is-dynamic="true"]'); // Fixed: Missing closing parenthesis
            if (!initialTitle && !initialContent) { // Si no se proporcionan valores iniciales (nueva creaci√≥n manual)
                newItemTitle = prompt("Ingrese el T√çTULO para el nuevo checkbox (lo que se muestra):");
                if (!newItemTitle || newItemTitle.trim() === "") {
                    createCustomAlert("El t√≠tulo del checkbox no puede estar vac√≠o.");
                    return;
                }
                newItemContent = prompt("Ingrese el CONTENIDO para el nuevo checkbox (lo que se copia):", newItemTitle);
                if (newItemContent === null) { // Si el usuario cancela el segundo prompt
                    return;
                }
            }


            const container = document.createElement('div');
            container.className = 'checkbox-item-container';

            const label = document.createElement('label');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.value = newItemContent; 
            checkbox.checked = isChecked; 

            // Adjuntar listener para la funci√≥n de actualizaci√≥n de pruebas
            checkbox.addEventListener('change', () => {
                const activeTabId = document.querySelector('.tab-content.active').id;
                if (activeTabId === 'tab1') {
                    actualizarPruebasRealizadas();
                } else if (activeTabId === 'tab2') {
                    updateMemoPruebasRealizadas(); // Llama a la funci√≥n espec√≠fica para memos
                }
            });

            label.appendChild(checkbox);
            label.appendChild(document.createTextNode(newItemTitle)); 

            const removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.className = 'manage-button remove-item';
            removeButton.textContent = 'X';
            removeButton.onclick = function() { removeCheckboxItem(this); };

            container.appendChild(label);
            container.appendChild(removeButton);

            const addButtonContainer = checkboxGroupElement.querySelector('.add-item-btn-container');
            if (addButtonContainer) {
                checkboxGroupElement.insertBefore(container, addButtonContainer);
            } else {
                checkboxGroupElement.appendChild(container);
            }
        };
        window.removeCheckboxItem = function(buttonElement) {
            createCustomConfirm('Are you sure you want to delete this item?', () => {
                const itemContainer = buttonElement.closest('.checkbox-item-container');
                if (itemContainer) {
                    itemContainer.remove();
                    // Despu√©s de eliminar, actualizar el campo de pruebas si aplica
                    const activeTabId = document.querySelector('.tab-content.active').id;
                    if (activeTabId === 'tab1') {
                        actualizarPruebasRealizadas();
                    } else if (activeTabId === 'tab2') {
                        updateMemoPruebasRealizadas(); 
                    }
                }
            });
        };


        // --- COMPLAINT MEMOS (TAB 2) ---
        const opcionesMemoQuejasDropdown = document.getElementById('opcionesMemoQuejas');
        const formContainerMemoQuejas = document.getElementById('formContainerMemoQuejas');
        const copyMemoQuejaButton = document.getElementById('copyMemoQuejaButton');
        const clearMemoQuejaButton = document.getElementById('clearMemoQuejaButton');
        const addMemoFieldBtn = document.getElementById('addMemoFieldBtn'); // Bot√≥n para agregar campo din√°mico

        // Estructura de plantillas de memos predefinidas
        const predefinedMemoTemplates = {
            "INTERNET DSL": [
                { label: "Luz Portadora", type: "checkbox-group", options: ["Fija", "Apagada", "Intermitente"], id:"luzPortadora" },
                { label: "Luz Internet", type: "checkbox-group", options: ["Fija", "Apagada", "Intermitente"], id:"luzInternet" },
                { label: "Estado del Puerto", type: "checkbox-group", options: ["UP", "DOWN", "DORMANT"], id:"estadoPuerto" },
                { label: "SNR", type: "textarea", id:"SNRniveles" },
                { label: "Estatus de niveles", type: "checkbox-group", options: ["Correctos", "Erroneos"], id:"estatusNiveles" },
                { label: "Velocidad Current igual a Pisa", type: "text", id: "velocidadPisa" },
                { label: "Canal da√±ado", type: "checkbox-group", options: ["Datos", "Voz", "Todos"], id:"canalDanado" },
                { label: "Problema Reportado", type: "textarea", id: "problemaReportadoQueja" },
                { label: "Pruebas Realizadas", type: "textarea", id: "pruebasRealizadasQueja" },
                { label: "Contacto En Sitio", type: "text", id: "contactoEnSitioQueja" },
                { label: "Tel Contacto", type: "text", id: "telContactoQueja" },
                { label: "Direcci√≥n", type: "text", id: "direccionQueja" },
                { label: "Queja", type: "text", id: "quejaNumero" },
                { label: "ID", type: "text", id: "idLlamadaQueja" }
            ],
            "TV DTH": [
                { label: "N√∫mero", type: "text", id:"tvDthNumero" }, { label: "No. Tvs Afectados", type: "text", id:"tvDthAfectados" },
                { label: "Serie STB", type: "text", id:"tvDthSerie" }, { label: "Smart Card", type: "text", id:"tvDthSmartCard" },
                { label: "Modelo STB", type: "text", id:"tvDthModelo" }, { label: "Mensaje Que Muestra Tv", type: "text", id:"tvDthMensaje" },
                { label: "Pruebas Realizadas", type: "textarea", id:"tvDthPruebas" }, { label: "Contacto En Sitio", type: "text", id:"tvDthContacto" },
                { label: "Tel. Contacto", type: "text", id:"tvDthTel" }, { label: "Direcci√≥n", type: "text", id:"tvDthDireccion" },
                { label: "Queja", type: "text", id:"tvDthQueja" }, { label: "ID", type: "text", id:"tvDthId" }
            ],
             "TV HFC": [
                { label: "N√∫mero", type: "text", id:"tvHfcNumero" }, { label: "No. Tvs Afectados", type: "text", id:"tvHfcAfectados" },
                { label: "No. Serie Stb", type: "text", id:"tvHfcSerie" }, { label: "Mensaje Que Muestra Tv", type: "text", id:"tvHfcMensaje" },
                { label: "Pruebas Realizadas", type: "textarea", id:"tvHfcPruebas" }, { label: "Contacto En Sitio", type: "text", id:"tvHfcContacto" },
                { label: "Tel. Contacto", type: "text", id:"tvHfcTel" }, { label: "Direcci√≥n", type: "text", id:"tvHfcDireccion" },
                { label: "Queja", type: "text", id:"tvHfcQueja" }, { label: "ID", type: "text", id:"tvHfcId" }
            ],
            "INTERNET HFC/LINEA": [
                { label: "Estado del Puerto", type: "checkbox-group", options: ["UP", "DOWN", "DORMANT"], id:"hfcEstadoPuerto" },
                { label: "Luz portadora", type: "checkbox-group", options: ["fija", "intermitente", "apagada"], id:"hfcluzportadora" },
                { label: "Luz online", type: "checkbox-group", options: ["fija", "intermitente", "apagada"], id:"hfcluzonline" },
                { label: "Niveles De Se√±al", type: "text", id:"hfcNivelesSenal" }, { label: "Niveles De Ruido", type: "text", id:"hfcNivelesRuido" },
                { label: "Estatus de niveles", type: "checkbox-group", options: ["Correctos", "Erroneos"], id:"hfcEstatusNiveles" },
                { label: "Mac Address", type: "text", id:"hfcMac" }, { label: "Problema Reportado", type: "textarea", id:"hfcProblema" },
                { label: "Pruebas Realizadas", type: "textarea", id:"hfcPruebas" }, { label: "Contacto En Sitio", type: "text", id:"hfcContacto" },
                { label: "Tel. Contacto", type: "text", id:"hfcTel" }, { label: "Direcci√≥n", type: "text", id:"hfcDireccion" },
                { label: "Queja", type: "text", id:"hfcQueja" }, { label: "ID", type: "text", id:"hfcId" }
            ],
            "LINEA FIJA": [
                { label: "Al Levantar El Auricular", type: "text", id:"lfAuricular" }, { label: "Cuando Le Llaman", type: "text", id:"lfLlaman" },
                { label: "Pruebas", type: "textarea", id:"lfPruebas" }, { label: "Contacto", type: "text", id:"lfContacto" },
                { label: "Tel Referencia", type: "text", id:"lfTelRef" }, { label: "Direcci√≥n", type: "text", id:"lfDireccion" },
                { label: "Queja", type: "text", id:"lfQueja" }, { label: "ID", type: "text", id:"lfId" }
            ],
            "GPON/LINEA": [
                { label: "Estatus de niveles:", type: "checkbox-group", options: ["Correctos", "Erroneos"], id:"gponEstatusNiveles" },
                { label: "Canal Da√±ado", type: "checkbox-group", options: ["Datos", "Voz", "Todos"], id:"gponCanalDanado" },
                { label: "PON", type: "checkbox-group", options: ["fija", "apagada", "intermitente"], id:"gponluzpon" },
                { label: "LOS", type: "checkbox-group", options: ["fija", "apagada", "roja"], id:"gponluzlos" },
                { label: "Problema Reportado", type: "textarea", id:"gponProblema" }, { label: "Pruebas Realizadas", type: "textarea", id:"gponPruebas" },
                { label: "Contacto En Sitio", type: "text", id:"gponContacto" }, { label: "Tel De Contacto", type: "text", id:"gponTel" },
                { label: "Direcci√≥n", type: "text", id:"gponDireccion" }, { label: "Queja", type: "text", id:"gponQueja" },
                { label: "ID", type: "text", id:"gponId" }
            ],
            "IPTV": [
                { label: "N√∫mero de Serie", type: "text", id:"iptvSerie" }, { label: "N√∫mero", type: "text", id:"iptvNumero" },
                { label: "Mensaje Que Muestra Tv", type: "text", id:"iptvMensaje" }, { label: "Descripci√≥n", type: "textarea", id:"iptvDescripcion" },
                { label: "Pruebas Realizadas", type: "textarea", id:"iptvPruebas" }, { label: "Nombre Cliente", type: "text", id:"iptvCliente" },
                { label: "N√∫mero De Contacto", type: "text", id:"iptvTel" }, { label: "Direcci√≥n", type: "text", id:"iptvDireccion" },
                { label: "Queja", type: "text", id:"iptvQueja" }, { label: "ID", type: "text", id:"iptvId" }
            ]
        };

        let customMemoTemplates = JSON.parse(localStorage.getItem('customMemoTemplates')) || {};

        function renderMemoFields(templateName) {
            formContainerMemoQuejas.innerHTML = ''; // Limpiar contenido anterior
            const templateFields = [...(predefinedMemoTemplates[templateName] || []), ...(customMemoTemplates[templateName] || [])];

            // Add "Quien genera queja" section at the top
            const quienGeneraWrapper = document.createElement('div');
            quienGeneraWrapper.className = 'dynamic-checkbox-group';
            const quienGeneraLabel = document.createElement('label');
            quienGeneraLabel.textContent = 'Quien genera queja:';
            quienGeneraWrapper.appendChild(quienGeneraLabel);
            const inlineGroup = document.createElement('div');
            inlineGroup.className = 'checkbox-group-inline'; // Aplicar estilo horizontal
            ['Telef√≥nico', 'Corporativo'].forEach(val => {
                const div = document.createElement('div');
                const check = document.createElement('input');
                check.type = 'checkbox'; check.value = val; check.id = `queja${val.replace(/\s+/g, '')}`;
                div.appendChild(check);
                const lbl = document.createElement('label');
                lbl.htmlFor = check.id; lbl.appendChild(document.createTextNode(val));
                div.appendChild(lbl);
                inlineGroup.appendChild(div);
                check.addEventListener('change', updateMemoPruebasRealizadas); // Add listener here
            });
            quienGeneraWrapper.appendChild(inlineGroup);
            formContainerMemoQuejas.appendChild(quienGeneraWrapper);


            templateFields.forEach((field) => {
                const wrapper = document.createElement('div');
                wrapper.className = 'form-group';
                wrapper.setAttribute('data-field-id', field.id); // Use unique ID for removal

                const labelEl = document.createElement('label');
                labelEl.textContent = field.label;
                if (field.id) labelEl.htmlFor = field.id;

                if(field.type === 'checkbox-group') {
                    const grupo = document.createElement('div');
                    grupo.className = 'checkbox-group-inline'; // Aplicar estilo horizontal
                    field.options.forEach((opcion, optIndex) => {
                        const contenedor = document.createElement('div');
                        const checkbox = document.createElement('input');
                        checkbox.type = 'checkbox'; checkbox.value = opcion;
                        if(field.id) checkbox.id = `${field.id}_${optIndex}`;
                        contenedor.appendChild(checkbox);
                        const optionLabel = document.createElement('label');
                        if(field.id) optionLabel.htmlFor = `${field.id}_${optIndex}`;
                        optionLabel.appendChild(document.createTextNode(opcion));
                        contenedor.appendChild(optionLabel);
                        grupo.appendChild(contenedor);
                        checkbox.addEventListener('change', updateMemoPruebasRealizadas); // Add listener here
                    });
                    wrapper.appendChild(labelEl);
                    wrapper.appendChild(grupo);
                } else {
                    const input = field.type === 'textarea' ? document.createElement('textarea') : document.createElement('input');
                    if (field.type !== 'textarea') input.type = field.type;
                    input.placeholder = field.label;
                    input.className = 'dynamic-input';
                    if (field.id) input.id = field.id;
                    wrapper.appendChild(labelEl);
                    wrapper.appendChild(input);
                }

                // Add remove button for dynamic fields
                if (field.dynamic) {
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'remove-dynamic-field-btn';
                    removeBtn.textContent = 'X';
                    removeBtn.title = 'Eliminar este campo';
                    removeBtn.onclick = () => removeMemoField(field.id, templateName); // Pass field.id
                    wrapper.appendChild(removeBtn);
                }

                formContainerMemoQuejas.appendChild(wrapper);
            });

            // Re-attach listeners for checkboxes in memo tab (for static ones)
            document.querySelectorAll('#tab2 .checkboxes-area-tab .checkbox-group input[type="checkbox"]').forEach(checkbox => {
                checkbox.removeEventListener('change', updateMemoPruebasRealizadas); // Prevent duplicates
                checkbox.addEventListener('change', updateMemoPruebasRealizadas);
            });
            // updateMemoPruebasRealizadas(); // Initial update - REMOVED: this would overwrite manual input
        }

        // Funci√≥n para actualizar el campo "Pruebas Realizadas" en la pesta√±a de Memos
        window.updateMemoPruebasRealizadas = function() {
            const dynamicPruebasRealizadas = formContainerMemoQuejas.querySelector('textarea[placeholder*="Pruebas Realizadas"]');
            if (dynamicPruebasRealizadas) {
                // Incluye checkboxes de los recuadros est√°ticos de la pesta√±a 2
                const checkboxesInMemoTab = document.querySelectorAll('#tab2 .checkboxes-area-tab .checkbox-group input[type="checkbox"]');
                // Incluye checkboxes de los grupos din√°micos dentro del formulario del memo
                const checkboxesInDynamicMemoForm = formContainerMemoQuejas.querySelectorAll('.dynamic-checkbox-group input[type="checkbox"]');

                const allCheckboxes = [...checkboxesInMemoTab, ...checkboxesInDynamicMemoForm];

                const seleccionadosMemo = [];
                allCheckboxes.forEach(chk => {
                    if (chk.checked) {
                        let texto = chk.value ? chk.value.trim() : '';
                        if (!texto) {
                            const label = chk.closest('label');
                            if (label) {
                                label.childNodes.forEach(node => {
                                    if (node.nodeType === Node.TEXT_NODE) texto += node.textContent.trim();
                                });
                                texto = texto.trim();
                            }
                        }
                        if (texto) seleccionadosMemo.push(texto);
                    }
                });
                dynamicPruebasRealizadas.value = seleccionadosMemo.join(', ');
            }
        }

        if (opcionesMemoQuejasDropdown) {
            opcionesMemoQuejasDropdown.addEventListener('change', function () {
                const seleccion = this.value;
                renderMemoFields(seleccion); // Render fields based on selection
                copyMemoQuejaButton.style.display = 'block';
                clearMemoQuejaButton.style.display = 'block';
                addMemoFieldBtn.style.display = 'block'; // Show add field button
                // After rendering, load saved values for memo fields (including Pruebas Realizadas)
                const savedData = JSON.parse(localStorage.getItem('omegaAppData'));
                if (savedData && savedData.memoQuejasData?.selectedType === seleccion && savedData.memoQuejasData.fields) {
                    for (const fieldId in savedData.memoQuejasData.fields) {
                        if (fieldId === 'quienGenera') {
                            const quienGeneraCheckboxes = document.querySelectorAll('#formContainerMemoQuejas .dynamic-checkbox-group input[type="checkbox"]');
                            quienGeneraCheckboxes.forEach(cb => {
                                cb.checked = savedData.memoQuejasData.fields[fieldId].includes(cb.value);
                            });
                        } else {
                            const fieldElement = document.getElementById(fieldId);
                            if (fieldElement) {
                                fieldElement.value = savedData.memoQuejasData.fields[fieldId];
                            }
                        }
                    }
                }
            });
        }

        // Funci√≥n para limpiar el memo de queja
        const clearMemoQueja = function() {
            formContainerMemoQuejas.innerHTML = '';
            opcionesMemoQuejasDropdown.selectedIndex = 0;
            copyMemoQuejaButton.style.display = 'none';
            clearMemoQuejaButton.style.display = 'none';
            addMemoFieldBtn.style.display = 'none'; // Hide add field button
            // Desmarcar todos los checkboxes de la pesta√±a de memos al limpiar
            document.querySelectorAll('#tab2 .checkbox-group input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
        };

        clearMemoQuejaButton?.addEventListener('click', clearMemoQueja);

        copyMemoQuejaButton?.addEventListener('click', function () {
            let content = '';
            const quienGeneraCheckboxes = formContainerMemoQuejas.querySelectorAll('.dynamic-checkbox-group input[type="checkbox"]');
            let quienGenera = [];
            quienGeneraCheckboxes.forEach(chk => { if(chk.checked) quienGenera.push(chk.value); });
            if(quienGenera.length > 0) content += `Quien genera queja: ${quienGenera.join(', ')}\n`;

            const grupos = formContainerMemoQuejas.querySelectorAll('.form-group');
            grupos.forEach(grupo => {
                const labelText = grupo.querySelector('label')?.textContent.replace(':', '') || 'Campo';
                const checkboxes = grupo.querySelectorAll('.checkbox-group-inline input[type="checkbox"]');
                const inputs = grupo.querySelectorAll('.dynamic-input, textarea');

                if(checkboxes.length > 0) {
                    const seleccionados = [];
                    checkboxes.forEach(checkbox => { if(checkbox.checked) seleccionados.push(checkbox.value); });
                    if(seleccionados.length > 0) content += `${labelText}: ${seleccionados.join(', ')}\n`;
                }

                inputs.forEach(input => {
                    // Only process inputs that are not part of the "Quien genera queja" group
                    if (!input.closest('.dynamic-checkbox-group')) {
                        const inputLabel = input.previousElementSibling && input.previousElementSibling.tagName === 'LABEL' ? input.previousElementSibling.textContent.replace(':', '') : labelText;
                        content += `${inputLabel}: ${input.value || '(Sin valor)'}\n`;
                    }
                });
            });

            const finalContent = content.trim();
            navigator.clipboard.writeText(finalContent).then(() => {
                createCustomAlert('Contenido del memo de queja copiado.');
                if (backupTemplatesTextarea) {
                    const now = new Date();
                    const timestamp = `${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;
                    backupTemplatesTextarea.value += `--- Memo de Queja (${opcionesMemoQuejasDropdown.value || 'Sin T√≠tulo'}) (${timestamp}) ---\n${finalContent}\n\n`;
                }
            }).catch(err => {
                console.error('Error al copiar memo de queja:', err);
            });
        });

        // Add Field to Memo
        addMemoFieldBtn?.addEventListener('click', function() {
            const selectedMemoType = opcionesMemoQuejasDropdown.value;
            if (!selectedMemoType) {
                createCustomAlert("Por favor, seleccione primero un tipo de memo.");
                return;
            }

            const fieldLabel = prompt("Ingrese la etiqueta para el nuevo campo:");
            if (!fieldLabel || fieldLabel.trim() === "") {
                createCustomAlert("La etiqueta del campo no puede estar vac√≠a.");
                return;
            }

            const fieldType = prompt("Ingrese el tipo de campo (text, textarea, checkbox):").toLowerCase();
            if (!['text', 'textarea', 'checkbox'].includes(fieldType)) {
                createCustomAlert("Tipo de campo inv√°lido. Use 'text', 'textarea' o 'checkbox'.");
                return;
            }

            let fieldOptions = [];
            if (fieldType === 'checkbox') {
                const optionsInput = prompt("Ingrese las opciones del checkbox separadas por comas (ej: Opci√≥n 1, Opci√≥n 2):");
                if (optionsInput === null) return; // User cancelled
                fieldOptions = optionsInput.split(',').map(opt => opt.trim()).filter(opt => opt !== '');
                if (fieldOptions.length === 0) {
                    createCustomAlert("Debe ingresar al menos una opci√≥n para el checkbox.");
                    return;
                }
            }

            const newField = {
                label: fieldLabel.trim(),
                type: fieldType === 'checkbox' ? 'checkbox-group' : fieldType,
                id: `dynamicField_${Date.now()}`, // Unique ID
                options: fieldOptions,
                dynamic: true // Mark as dynamic
            };

            if (!customMemoTemplates[selectedMemoType]) {
                customMemoTemplates[selectedMemoType] = [];
            }
            customMemoTemplates[selectedMemoType].push(newField);
            localStorage.setItem('customMemoTemplates', JSON.stringify(customMemoTemplates));

            renderMemoFields(selectedMemoType); // Re-render to include the new field
            createCustomAlert(`Campo "${fieldLabel}" agregado al memo "${selectedMemoType}".`);
        });

        // Remove Field from Memo
        window.removeMemoField = function(fieldIdToRemove, memoType) {
            createCustomConfirm('¬øEst√°s seguro de que quieres eliminar este campo din√°mico?', () => {
                if (customMemoTemplates[memoType]) {
                    customMemoTemplates[memoType] = customMemoTemplates[memoType].filter(field => field.id !== fieldIdToRemove);
                    localStorage.setItem('customMemoTemplates', JSON.stringify(customMemoTemplates));
                    renderMemoFields(memoType); // Re-render to reflect changes
                    createCustomAlert(`Campo eliminado del memo "${memoType}".`);
                }
            });
        };


        // --- WF TEMPLATES (TAB 3) ---
        // ... (Existing WF templates code)
        const wfDropdown = document.getElementById('wfDropdown');
        const notaswfTextarea = document.getElementById('notaswfTextarea');
        const copyTextareawf = document.getElementById('copyTextareawf');
        const clearWfTemplateButton = document.getElementById('clearWfTemplateButton');
        const addWfTemplateBtn = document.getElementById('addWfTemplateBtn');
        const editWfTemplateBtn = document.getElementById('editWfTemplateBtn');
        const removeWfTemplateBtn = document.getElementById('removeWfTemplateBtn');

        let customWfTemplates = JSON.parse(localStorage.getItem('customWfTemplates')) || {};

        function loadWfTemplates() {
            wfDropdown.innerHTML = '<option selected disabled value="">-- Seleccione Plantilla WF --</option>';
            // Combinar plantillas por defecto y personalizadas
            const allTemplates = { ...defaultWfTemplates, ...customWfTemplates };

            for (const key in allTemplates) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = key;
                wfDropdown.appendChild(option);
            }
        }

        wfDropdown?.addEventListener('change', function() {
            const selectedTemplateName = this.value;
            const allTemplates = { ...defaultWfTemplates, ...customWfTemplates };
            notaswfTextarea.value = allTemplates[selectedTemplateName] || '';
        });

        copyTextareawf?.addEventListener('click', function () {
            if (notaswfTextarea && notaswfTextarea.value) {
                notaswfTextarea.select();
                notaswfTextarea.setSelectionRange(0, 99999); 
                document.execCommand('copy');
                createCustomAlert('WF template text copied.');
                if (backupTemplatesTextarea) {
                    const now = new Date();
                    const timestamp = `${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;
                    backupTemplatesTextarea.value += `--- WF Template (${wfDropdown.value || 'No Title'}) (${timestamp}) ---\n${notaswfTextarea.value}\n\n`;
                }
            } else {
                createCustomAlert("No text in the WF template to copy.");
            }
        });

        clearWfTemplateButton?.addEventListener('click', function() {
            createCustomConfirm('Are you sure you want to clear the current WF template?', () => {
                notaswfTextarea.value = '';
                wfDropdown.selectedIndex = 0;
            });
        });

        addWfTemplateBtn?.addEventListener('click', function() {
            const templateName = prompt("Enter the name for the new WF template:");
            if (templateName && templateName.trim() !== "") {
                if (defaultWfTemplates[templateName.trim()]) {
                    createCustomAlert("A default template with that name already exists. Please choose another name.");
                    return;
                }
                const templateContent = prompt("Enter the content for the new WF template:");
                if (templateContent !== null) { 
                    customWfTemplates[templateName.trim()] = templateContent;
                    localStorage.setItem('customWfTemplates', JSON.stringify(customWfTemplates));
                    loadWfTemplates();
                    wfDropdown.value = templateName.trim(); 
                    notaswfTextarea.value = templateContent;
                    createCustomAlert(`Template "${templateName.trim()}" saved.`);
                }
            } else {
                createCustomAlert("Template name cannot be empty.");
            }
        });

        editWfTemplateBtn?.addEventListener('click', function() {
            const selectedTemplateName = wfDropdown.value;
            if (selectedTemplateName && selectedTemplateName !== "") {
                if (defaultWfTemplates[selectedTemplateName]) {
                    createCustomAlert("Default templates cannot be edited. Please create a new template with a different name if you wish to modify it.");
                    return;
                }
                const currentContent = notaswfTextarea.value;
                const newContent = prompt(`Edit the content of the template "${selectedTemplateName}":`, currentContent);
                if (newContent !== null) {
                    customWfTemplates[selectedTemplateName] = newContent;
                    localStorage.setItem('customWfTemplates', JSON.stringify(customWfTemplates));
                    notaswfTextarea.value = newContent;
                    createCustomAlert(`Template "${selectedTemplateName}" updated.`);
                }
            } else {
                createCustomAlert("Select a template to edit.");
            }
        });

        removeWfTemplateBtn?.addEventListener('click', function() {
            const selectedTemplateName = wfDropdown.value;
            if (selectedTemplateName && selectedTemplateName !== "") {
                if (defaultWfTemplates[selectedTemplateName]) {
                    createCustomAlert("Default templates cannot be deleted.");
                    return;
                }
                createCustomConfirm(`Are you sure you want to delete the template "${selectedTemplateName}"?`, () => {
                    delete customWfTemplates[selectedTemplateName];
                    localStorage.setItem('customWfTemplates', JSON.stringify(customWfTemplates));
                    loadWfTemplates();
                    notaswfTextarea.value = '';
                    createCustomAlert(`Template "${selectedTemplateName}" deleted.`);
                });
            } else {
                createCustomAlert("Select a template to delete.");
            }
        });

        loadWfTemplates(); 


        // --- SAVED TEMPLATES (TAB 5) ---
        // ... (Existing saved templates code)
        const copyBackupButton = document.getElementById('copyBackupButton');
        const clearBackupButton = document.getElementById('clearBackupButton');
        if (copyBackupButton && backupTemplatesTextarea) {
            copyBackupButton.addEventListener('click', function() {
                if (backupTemplatesTextarea.value) {
                    backupTemplatesTextarea.select();
                    backupTemplatesTextarea.setSelectionRange(0, 99999);
                    document.execCommand('copy');
                    createCustomAlert('Backup content copied.');
                } else {
                    createCustomAlert('No content in backup to copy.');
                }
            });
        }
        if (clearBackupButton && backupTemplatesTextarea) {
            clearBackupButton.addEventListener('click', function() {
                createCustomConfirm('Are you sure you want to clear the backup?', () => {
                    backupTemplatesTextarea.value = '';
                });
            });
        }


        // --- TRANSFERS (TAB 4) ---
        // ... (Existing transfers code)
        const dynamicTransfersList = document.getElementById('dynamicTransfersList');
        const addTransferBtn = document.getElementById('addTransferBtn');
        let customTransferItems = JSON.parse(localStorage.getItem('customTransferItems')) || [];
        const defaultTransferItems = [
            { service: "SERVICIO MOVIL", value: "gt_movil_soporte" },
            { service: "COMERCIAL", value: "GT_RESIDENCIAL_INFORMACION" },
            { service: "CENTRO DE PAGOS", value: "GT_CENTRO DE PAGOS" },
            { service: "AGREGAR NUMERO A LA LLAMADA", value: "GT_RESIDENCIAL_SOPORTE_LINEA -" },
            { service: "CORPORATIVO", value: "24201414" },
            { service: "CAMBIO DE CONTRASE√ëA Y DEMAS", value: "24201400" },
            { service: "LLAMADAS DESDE TIGO", value: "25028850" },
            { service: "WHATSAPP", value: "42147100" }
        ];
        function renderTransferItems() {
            dynamicTransfersList.innerHTML = ''; 
            const allTransfers = [...defaultTransferItems, ...customTransferItems];
            allTransfers.forEach((item, index) => {
                const p = document.createElement('p');
                const strong = document.createElement('strong');
                strong.textContent = `${item.service}:`;
                p.appendChild(strong);
                p.appendChild(document.createTextNode(` ${item.value}`));
                if (index >= defaultTransferItems.length) {
                    const removeButton = document.createElement('button');
                    removeButton.type = 'button';
                    removeButton.className = 'manage-button remove-item';
                    removeButton.textContent = 'X';
                    removeButton.onclick = function() { removeTransferItem(this, item.service); }; 
                    p.appendChild(removeButton);
                }
                dynamicTransfersList.appendChild(p);
            });
        }
        addTransferBtn?.addEventListener('click', () => {
            const service = prompt("Enter the SERVICE for the new transfer:");
            if (!service || service.trim() === "") {
                createCustomAlert("Service cannot be empty.");
                return;
            }
            const value = prompt("Enter the VALUE for the new transfer (e.g., number or name):");
            if (value === null) { 
                return;
            }
            customTransferItems.push({ service: service.trim(), value: value.trim() });
            localStorage.setItem('customTransferItems', JSON.stringify(customTransferItems));
            renderTransferItems();
            createCustomAlert(`Transfer "${service}" added.`);
        });
        function removeTransferItem(buttonElement, serviceToRemove) {
            createCustomConfirm(`Are you sure you want to delete the transfer for "${serviceToRemove}"?`, () => {
                const itemContainer = buttonElement.closest('p');
                if (itemContainer) {
                    customTransferItems = customTransferItems.filter(item => item.service !== serviceToRemove);
                    localStorage.setItem('customTransferItems', JSON.stringify(customTransferItems));
                    renderTransferItems(); 
                    createCustomAlert(`Transfer for "${serviceToRemove}" deleted.`);
                }
            });
        }
        renderTransferItems(); 


        // --- AVISOS TAB (TAB 7) ---
        const noticesListDiv = document.getElementById('noticesList');
        // El array hardcodedNotices ha sido eliminado, ya que el recuadro que lo mostraba fue removido.

        function renderHardcodedNotices() {
            // Esta funci√≥n ya no es necesaria ya que el recuadro noticesListDiv ha sido eliminado.
            // Se mantiene como un placeholder si en el futuro se desea a√±adir l√≥gica de avisos.
            if (!noticesListDiv) {
                console.warn("Warning: noticesListDiv not found. Hardcoded notices will not be displayed.");
                return;
            }
            noticesListDiv.innerHTML = '<p class="no-notices-message">No hay avisos disponibles en este momento.</p>';
            console.log("Hardcoded notices rendering logic skipped as the display box is removed.");
        }

        // --- Document Viewer Functions ---
        window.loadDocumentInIframe = function(iframeId, docUrl) {
            const iframe = document.getElementById(iframeId);
            if (iframe) {
                // Eliminar cualquier mensaje de error existente
                const existingErrorMessage = iframe.parentNode.querySelector('.iframe-error-message');
                if (existingErrorMessage) {
                    existingErrorMessage.remove();
                }
                iframe.style.display = 'block'; // Mostrar iframe
                iframe.src = docUrl;
                console.log(`Cargando documento en ${iframeId}: ${docUrl}`);
            } else {
                console.error(`Iframe con ID ${iframeId} no encontrado.`);
            }
        };


        // --- EXPORT / IMPORT / SAVE DATA ---
        const exportDataBtn = document.getElementById('exportDataBtn');
        const importDataInput = document.getElementById('importDataInput');
        const saveDataBtn = document.getElementById('saveDataBtn');

        // Refactor the save logic into a function
        function saveAllCurrentData() {
            const currentThemeSettings = {};
            themeColorInputs.forEach(inputConf => {
                const key = inputConf.cssVar || inputConf.neuronVar;
                currentThemeSettings[key] = document.documentElement.style.getPropertyValue(key).trim() || defaultThemeSettings[key];
            });

            const dataToSave = {
                genericFormData: {
                    id: document.getElementById('id')?.value || '',
                    nombreCliente: document.getElementById('nombreCliente')?.value || '',
                    numeroInconveniente: document.getElementById('numeroInconveniente')?.value || '',
                    Inconveniente: document.getElementById('Inconveniente')?.value || '',
                    tipoServicio: document.getElementById('tipoServicio')?.value || '',
                    pruebasRealizadas: document.getElementById('pruebasRealizadas')?.value || '' // Capture current value
                },
                checkboxStatesTab1: Array.from(document.querySelectorAll('#tab1 .checkbox-group')).map(group => ({
                    groupId: group.dataset.groupId,
                    items: Array.from(group.querySelectorAll('.checkbox-item-container')).map(item => ({
                        value: item.querySelector('input[type="checkbox"]')?.value || '',
                        checked: item.querySelector('input[type="checkbox"]')?.checked || false,
                        title: item.querySelector('label')?.childNodes[1]?.textContent.trim() || '',
                        isDefault: item.dataset.default === 'true'
                    }))
                })),
                memoQuejasData: {
                    selectedType: opcionesMemoQuejasDropdown?.value || '',
                    fields: {}
                },
                checkboxStatesTab2: Array.from(document.querySelectorAll('#tab2 .checkbox-group')).map(group => ({
                    groupId: group.dataset.groupId,
                    items: Array.from(group.querySelectorAll('.checkbox-item-container')).map(item => ({
                        value: item.querySelector('input[type="checkbox"]')?.value || '',
                        checked: item.querySelector('input[type="checkbox"]')?.checked || false,
                        title: item.querySelector('label')?.childNodes[1]?.textContent.trim() || '',
                        isDefault: item.dataset.default === 'true'
                    }))
                })),
                customWfTemplates: customWfTemplates,
                notesContent: notesArea?.value || '',
                backupTemplatesContent: backupTemplatesTextarea?.value || '',
                customTransferItems: customTransferItems,
                draggableBoxStates: Array.from(document.querySelectorAll('.draggable-box')).map(box => {
                    const titleElement = box.querySelector('.drag-handle span');
                    const dynamicBoxCheckboxes = [];
                    if (box.dataset.isDynamic === 'true') {
                        Array.from(box.querySelectorAll('.checkbox-group.dynamic-checkbox-area .checkbox-item-container')).forEach(item => {
                            dynamicBoxCheckboxes.push({
                                value: item.querySelector('input[type="checkbox"]')?.value || '',
                                checked: item.querySelector('input[type="checkbox"]')?.checked || false,
                                title: item.querySelector('label')?.childNodes[1]?.textContent.trim() || ''
                            });
                        });
                    }
                    return {
                        id: box.id,
                        tabId: box.closest('.tab-content')?.id,
                        left: box.style.left,
                        top: box.style.top,
                        width: box.style.width,
                        height: box.style.height,
                        title: titleElement ? titleElement.textContent.trim() : '',
                        isDynamic: box.dataset.isDynamic === 'true',
                        dynamicCheckboxes: dynamicBoxCheckboxes
                    };
                }),
                themeSettings: currentThemeSettings
            };

            // Populate memoQuejasData.fields
            if (opcionesMemoQuejasDropdown?.value) {
                const memoFields = document.querySelectorAll('#formContainerMemoQuejas .dynamic-input, #formContainerMemoQuejas textarea');
                memoFields.forEach(field => {
                    dataToSave.memoQuejasData.fields[field.id] = field.value;
                });
                const quienGeneraCheckboxes = document.querySelectorAll('#formContainerMemoQuejas .dynamic-checkbox-group input[type="checkbox"]');
                dataToSave.memoQuejasData.fields['quienGenera'] = Array.from(quienGeneraCheckboxes).filter(cb => cb.checked).map(cb => cb.value);
            }

            localStorage.setItem('omegaAppData', JSON.stringify(dataToSave));
            console.log("Data saved to localStorage.");
        }

        // Refactor the load logic into a function
        function loadAllSavedData() {
            const savedData = JSON.parse(localStorage.getItem('omegaAppData'));
            if (savedData) {
                // Restore theme first
                if (savedData.themeSettings) {
                    for (const varName in savedData.themeSettings) {
                        document.documentElement.style.setProperty(varName, savedData.themeSettings[varName]);
                        if (varName === '--neuron-color-1-rgb') globalNeuronColorsRGB[0] = savedData.themeSettings[varName];
                        else if (varName === '--neuron-color-2-rgb') globalNeuronColorsRGB[1] = savedData.themeSettings[varName];
                        else if (varName === '--neuron-color-3-rgb') globalNeuronColorsRGB[2] = savedData.themeSettings[varName];
                        else if (varName === '--neuron-connection-rgb') globalNeuronConnectionRGB = savedData.themeSettings[varName];
                    }
                    if (typeof init_particles === "function") init_particles();
                    initializeThemeWidget();
                } else {
                    initializeThemeWidget();
                }

                // Restore generic template
                if (savedData.genericFormData) {
                    document.getElementById('id').value = savedData.genericFormData.id || '';
                    document.getElementById('nombreCliente').value = savedData.genericFormData.nombreCliente || '';
                    document.getElementById('numeroInconveniente').value = savedData.genericFormData.numeroInconveniente || '';
                    document.getElementById('Inconveniente').value = savedData.genericFormData.Inconveniente || '';
                    document.getElementById('tipoServicio').value = savedData.genericFormData.tipoServicio || '';
                    // Restore pruebasRealizadas manually, do NOT call actualizarPruebasRealizadas here
                    document.getElementById('pruebasRealizadas').value = savedData.genericFormData.pruebasRealizadas || '';
                }

                // Restore checkboxes for Tab 1
                if (savedData.checkboxStatesTab1) {
                    savedData.checkboxStatesTab1.forEach(savedGroup => {
                        const checkboxGroupElement = document.querySelector(`#tab1 .checkbox-group[data-group-id="${savedGroup.groupId}"]`);
                        if (checkboxGroupElement) {
                            Array.from(checkboxGroupElement.querySelectorAll('.checkbox-item-container:not([data-default="true"])')).forEach(item => item.remove());
                            savedGroup.items.forEach(savedCb => {
                                if (savedCb.isDefault) {
                                    const defaultCheckbox = checkboxGroupElement.querySelector(`input[type="checkbox"][value="${savedCb.value}"]`);
                                    if (defaultCheckbox) {
                                        defaultCheckbox.checked = savedCb.checked;
                                    }
                                } else {
                                    addCheckboxItem(checkboxGroupElement, savedCb.title, savedCb.value, savedCb.checked);
                                }
                            });
                        }
                    });
                    // Do NOT call actualizarPruebasRealizadas() here, it would overwrite manual input
                }

                // Restore complaint memo data
                if (savedData.memoQuejasData?.selectedType) {
                    opcionesMemoQuejasDropdown.value = savedData.memoQuejasData.selectedType;
                    // Trigger change to re-render fields, but prevent immediate updateMemoPruebasRealizadas
                    opcionesMemoQuejasDropdown.dispatchEvent(new Event('change')); 
                    if (savedData.memoQuejasData.fields) {
                        for (const fieldId in savedData.memoQuejasData.fields) {
                            if (fieldId === 'quienGenera') {
                                const quienGeneraCheckboxes = document.querySelectorAll('#formContainerMemoQuejas .dynamic-checkbox-group input[type="checkbox"]');
                                quienGeneraCheckboxes.forEach(cb => {
                                    cb.checked = savedData.memoQuejasData.fields[fieldId].includes(cb.value);
                                });
                            } else {
                                const fieldElement = document.getElementById(fieldId);
                                if (fieldElement) {
                                    fieldElement.value = savedData.memoQuejasData.fields[fieldId];
                                }
                            }
                        }
                    }
                } else {
                    clearMemoQueja(); // Clear memo fields if no data is saved
                }

                // Restore checkboxes for Tab 2 (Memos)
                if (savedData.checkboxStatesTab2) {
                    savedData.checkboxStatesTab2.forEach(savedGroup => {
                        const checkboxGroupElement = document.querySelector(`#tab2 .checkbox-group[data-group-id="${savedGroup.groupId}"]`);
                        if (checkboxGroupElement) {
                            Array.from(checkboxGroupElement.querySelectorAll('.checkbox-item-container:not([data-default="true"])')).forEach(item => item.remove());
                            savedGroup.items.forEach(savedCb => {
                                if (savedCb.isDefault) {
                                    const defaultCheckbox = checkboxGroupElement.querySelector(`input[type="checkbox"][value="${savedCb.value}"]`);
                                    if (defaultCheckbox) {
                                        defaultCheckbox.checked = savedCb.checked;
                                    }
                                } else {
                                    addCheckboxItem(checkboxGroupElement, savedCb.title, savedCb.value, savedCb.checked);
                                }
                            });
                        }
                    });
                    // Do NOT call updateMemoPruebasRealizadas() here, it would overwrite manual input
                }

                if (savedData.customWfTemplates) {
                    customWfTemplates = savedData.customWfTemplates;
                    loadWfTemplates();
                }
                if (notesArea && savedData.notesContent !== undefined) {
                    notesArea.value = savedData.notesContent;
                }
                if (backupTemplatesTextarea && savedData.backupTemplatesContent !== undefined) {
                    backupTemplatesTextarea.value = savedData.backupTemplatesContent;
                }
                if (savedData.customTransferItems) {
                    customTransferItems = savedData.customTransferItems;
                    renderTransferItems();
                }

                // Restore draggable box states
                if (savedData.draggableBoxStates) {
                    // Remove all existing dynamic boxes before recreating
                    document.querySelectorAll('.draggable-box[data-is-dynamic="true"]').forEach(box => box.remove());
                    savedData.draggableBoxStates.forEach(state => {
                        let box = document.getElementById(state.id);
                        if (!box && state.isDynamic) {
                            box = recreateDynamicBox(state.tabId, state.id, state.title, state.dynamicCheckboxes);
                        }
                        if (box && box.closest('.tab-content')?.id === state.tabId) {
                            box.style.position = 'absolute';
                            box.style.left = state.left;
                            box.style.top = state.top;
                            box.style.width = state.width;
                            box.style.height = state.height;
                            const titleElement = box.querySelector('.drag-handle span');
                            if (titleElement) {
                                titleElement.textContent = state.title;
                            }
                            makeElementDraggableAndResizable(box);
                        }
                    });
                }
            } else {
                // No saved data, ensure theme pickers are set to CSS defaults
                initializeThemeWidget();
            }
            console.log("Data loaded from localStorage.");
        }


        saveDataBtn?.addEventListener('click', () => {
            saveAllCurrentData();
            createCustomAlert('Data and theme saved locally.');
        });

        exportDataBtn?.addEventListener('click', () => {
            // Get the latest saved data directly from localStorage
            const dataToExport = JSON.parse(localStorage.getItem('omegaAppData')); 
            if (!dataToExport) {
                createCustomAlert('No data to export. Please save some data first.');
                return;
            }
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'omega_data.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            createCustomAlert('Data exported successfully.');
        });

        importDataInput?.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        createCustomConfirm('Are you sure you want to import this data? This will overwrite current data.', () => {
                            localStorage.setItem('omegaAppData', JSON.stringify(importedData)); // Save imported data to localStorage
                            loadAllSavedData(); // Load all data from localStorage
                            createCustomAlert('Data imported successfully.');
                        });
                    } catch (error) {
                        console.error('Error importing data:', error);
                        createCustomAlert('Error importing data. Make sure the file is a valid JSON.');
                    }
                };
                reader.readAsText(file);
            }
        });


        // --- LOGIC TO MAKE ELEMENTS DRAGGABLE AND RESIZABLE ---
        // ... (Existing draggable logic)
        function makeElementDraggableAndResizable(elmnt) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            let isResizing = false;
            const dragHandle = elmnt.querySelector(".drag-handle");
            const minWidth = 280; 
            const minHeight = 150; 

            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                const rect = elmnt.getBoundingClientRect();
                const resizeHandleSize = 15; 
                if (e.clientX > rect.right - resizeHandleSize && e.clientY > rect.bottom - resizeHandleSize) {
                    isResizing = true;
                    elmnt.style.cursor = 'se-resize';
                } else {
                    isResizing = false;
                    if (dragHandle && dragHandle.contains(e.target)) { // Only grab if on handle
                        elmnt.style.cursor = 'grabbing';
                    }
                }

                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragOrResizeElement;
                document.onmousemove = elementDragOrResize;
                
                if (isResizing || (dragHandle && dragHandle.contains(e.target))) {
                    elmnt.classList.add("dragging");
                    elmnt.style.position = 'absolute'; 
                    elmnt.style.zIndex = parseInt(elmnt.style.zIndex || 1) + 99; 
                }
            }

            function elementDragOrResize(e) {
                e = e || window.event;
                e.preventDefault();

                if (isResizing) {
                    let newWidth = elmnt.offsetWidth + (e.clientX - pos3);
                    let newHeight = elmnt.offsetHeight + (e.clientY - pos4);
                    if (newWidth >= minWidth) elmnt.style.width = newWidth + "px";
                    if (newHeight >= minHeight) elmnt.style.height = newHeight + "px";
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                } else if (elmnt.classList.contains("dragging") && dragHandle && elmnt.style.cursor === 'grabbing') { // Ensure dragging only if intended
                    pos1 = pos3 - e.clientX;
                    pos2 = pos4 - e.clientY;
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    let newTop = elmnt.offsetTop - pos2;
                    let newLeft = elmnt.offsetLeft - pos1;
                    elmnt.style.top = newTop + "px";
                    elmnt.style.left = newLeft + "px";
                }
            }

            function closeDragOrResizeElement() {
                document.onmouseup = null;
                document.onmousemove = null;
                if (elmnt.classList.contains("dragging")) {
                    elmnt.classList.remove("dragging");
                    elmnt.style.zIndex = parseInt(elmnt.style.zIndex || 100) - 98; 
                }
                elmnt.style.cursor = dragHandle && dragHandle.contains(event.target) ? 'grab' : 'default';
                isResizing = false;
            }

            if (dragHandle) {
                dragHandle.onmousedown = dragMouseDown;
            }
            elmnt.addEventListener('mousemove', function(e) {
                const rect = elmnt.getBoundingClientRect();
                const resizeHandleSize = 15;
                if (e.clientX > rect.right - resizeHandleSize && e.clientY > rect.bottom - resizeHandleSize) {
                    elmnt.style.cursor = 'se-resize';
                } else if (!isResizing && !(dragHandle && dragHandle.contains(e.target) && elmnt.style.cursor === 'grabbing')) {
                     elmnt.style.cursor = dragHandle && dragHandle.contains(e.target) ? 'grab' : 'default';
                }
            });
        }
        window.initializeDraggableElements = function() {
            const activeTab = document.querySelector('.tab-content.active');
            if (activeTab) {
                activeTab.querySelectorAll('.draggable-box').forEach(box => {
                    // Solo aplicar posicionamiento absoluto si no tiene ya un estilo de posici√≥n
                    // Esto evita que los elementos est√°ticos se muevan al cargar
                    if (!box.style.left && !box.style.top && box.style.position !== 'absolute') { 
                        const rect = box.getBoundingClientRect();
                        const containerRect = activeTab.getBoundingClientRect();
                        let initialTop = rect.top - containerRect.top + activeTab.scrollTop;
                        let initialLeft = rect.left - containerRect.left + activeTab.scrollLeft;
                        
                        // Si el elemento est√° dentro de .checkboxes-area-tab, calcular su posici√≥n relativa a ese contenedor
                        const parentCheckboxesArea = box.closest('.checkboxes-area-tab');
                        if (parentCheckboxesArea && parentCheckboxesArea.contains(box)) {
                            const parentAreaRect = parentCheckboxesArea.getBoundingClientRect();
                            initialTop = rect.top - parentAreaRect.top + parentCheckboxesArea.scrollLeft; // Corrected to scrollLeft for horizontal positioning
                            initialLeft = rect.left - parentAreaRect.left + parentCheckboxesArea.scrollLeft;
                        }

                        box.style.position = 'absolute';
                        box.style.top = `${initialTop}px`;
                        box.style.left = `${initialLeft}px`;
                        if (!box.style.width) box.style.width = `${rect.width}px`;
                        if (!box.style.height) box.style.height = `${rect.height}px`;
                    } else if (box.style.position !== 'absolute'){
                         box.style.position = 'absolute';
                    }
                    makeElementDraggableAndResizable(box);
                });
            }
        }


        // --- FUNCTIONS TO HANDLE DYNAMIC BOXES ---
        // ... (Existing dynamic box functions)
        document.getElementById('addBoxToActiveTabBtn')?.addEventListener('click', function() {
            const activeTab = document.querySelector('.tab-content.active');
            if (activeTab) {
                addNewDraggableBox(activeTab.id);
            } else {
                createCustomAlert("Please select a tab first to add a new box.");
            }
        });
        window.addNewDraggableBox = function(tabId) {
            const container = document.querySelector(`#${tabId} .main-container-tab`);
            if (!container) {
                console.error(`Container for tab ${tabId} not found.`);
                return;
            }
            const newBoxId = `dynamic-box-${Date.now()}`;
            const newBoxTitle = prompt("Enter the title for the new box:", "New Custom Box");
            if (!newBoxTitle || newBoxTitle.trim() === "") {
                createCustomAlert("Box title cannot be empty.");
                return;
            }
            const newBox = document.createElement('div');
            newBox.className = 'draggable-box';
            newBox.id = newBoxId;
            newBox.dataset.isDynamic = 'true'; 
            const dragHandle = document.createElement('h3'); 
            dragHandle.className = 'drag-handle';
            const titleSpan = document.createElement('span');
            titleSpan.textContent = newBoxTitle.trim();
            dragHandle.appendChild(titleSpan);
            const editButton = document.createElement('button');
            editButton.type = 'button';
            editButton.className = 'edit-title-btn';
            editButton.textContent = '‚úèÔ∏è';
            editButton.onclick = () => editBoxTitle(titleSpan);
            dragHandle.appendChild(editButton);
            const removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.className = 'remove-box-btn';
            removeButton.textContent = '‚ùå';
            removeButton.onclick = () => removeDraggableBox(newBox);
            dragHandle.appendChild(removeButton);
            newBox.appendChild(dragHandle);
            const contentDiv = document.createElement('div');
            contentDiv.innerHTML = `
                <div class="checkbox-group dynamic-checkbox-area" data-group-id="${newBoxId}-checkboxes">
                    <p style="margin-bottom: 15px; color: var(--texto-intermedio);">Agrega checkboxes a este recuadro:</p>
                    <div class="add-item-btn-container">
                        <button type="button" class="manage-button" onclick="addCheckboxItem(this.closest('.checkbox-group'))">Agregar Checkbox</button>
                    </div>
                </div>
            `;
            newBox.appendChild(contentDiv);
            const dynamicCheckboxGroup = newBox.querySelector('.checkbox-group.dynamic-checkbox-area');
            // dynamicCheckboxes is not defined here. It should be passed if recreating from saved state.
            // For a newly added box, this array would be empty.
            // if (dynamicCheckboxGroup && dynamicCheckboxes.length > 0) {
            //     dynamicCheckboxes.forEach(cb => {
            //         addCheckboxItem(dynamicCheckboxGroup, cb.title, cb.value, cb.checked);
            //     });
            // }
            container.appendChild(newBox);
            newBox.style.position = 'absolute';
            newBox.style.left = '20px'; 
            newBox.style.top = '20px';  
            makeElementDraggableAndResizable(newBox);
            createCustomAlert(`Box "${newBoxTitle}" added.`);
            toggleWidget(addBoxWidget, document.getElementById('toggleAddBox'));
        };
        window.recreateDynamicBox = function(tabId, boxId, boxTitle, dynamicCheckboxes = []) {
            const container = document.querySelector(`#${tabId} .main-container-tab`);
            if (!container) return null;
            const newBox = document.createElement('div');
            newBox.className = 'draggable-box';
            newBox.id = boxId;
            newBox.dataset.isDynamic = 'true';
            const dragHandle = document.createElement('h3');
            dragHandle.className = 'drag-handle';
            const titleSpan = document.createElement('span');
            titleSpan.textContent = boxTitle;
            dragHandle.appendChild(titleSpan);
            const editButton = document.createElement('button');
            editButton.type = 'button';
            editButton.className = 'edit-title-btn';
            editButton.textContent = '‚úèÔ∏è';
            editButton.onclick = () => editBoxTitle(titleSpan);
            dragHandle.appendChild(editButton);
            const removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.className = 'remove-box-btn';
            removeButton.textContent = '‚ùå';
            removeButton.onclick = () => removeDraggableBox(newBox);
            dragHandle.appendChild(removeButton);
            newBox.appendChild(dragHandle);
            const contentDiv = document.createElement('div');
            contentDiv.innerHTML = `
                <div class="checkbox-group dynamic-checkbox-area" data-group-id="${boxId}-checkboxes">
                    <p style="margin-bottom: 15px; color: var(--texto-intermedio);">Agrega checkboxes a este recuadro:</p>
                    <div class="add-item-btn-container">
                        <button type="button" class="manage-button" onclick="addCheckboxItem(this.closest('.checkbox-group'))">Agregar Checkbox</button>
                    </div>
                </div>
            `;
            newBox.appendChild(contentDiv);
            const dynamicCheckboxGroup = newBox.querySelector('.checkbox-group.dynamic-checkbox-area');
            if (dynamicCheckboxGroup && dynamicCheckboxes.length > 0) {
                dynamicCheckboxes.forEach(cb => {
                    addCheckboxItem(dynamicCheckboxGroup, cb.title, cb.value, cb.checked);
                });
            }
            container.appendChild(newBox);
            makeElementDraggableAndResizable(newBox); 
            return newBox;
        };
        window.editBoxTitle = function(titleSpanElement) {
            const currentTitle = titleSpanElement.textContent.trim();
            const newTitle = prompt("Edit the box title:", currentTitle);
            if (newTitle !== null && newTitle.trim() !== "") {
                titleSpanElement.textContent = newTitle.trim();
            } else if (newTitle !== null && newTitle.trim() === "") { 
                createCustomAlert("Title cannot be empty.");
            }
        };
        window.removeDraggableBox = function(boxElement) {
            createCustomConfirm('Are you sure you want to delete this box? This action cannot be undone.', () => {
                boxElement.remove();
                createCustomAlert('Box deleted.');
            });
        };


        // --- CUSTOM ALERT/CONFIRM MODALS ---
        // ... (Existing alert/confirm code)
        function createCustomAlert(message) {
            const modalId = 'customAlertModal';
            let modal = document.getElementById(modalId);
            if (modal) modal.remove(); 
            modal = document.createElement('div');
            modal.id = modalId;
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background-color: rgba(0,0,0,0.6); display: flex;
                justify-content: center; align-items: center; z-index: 10000;
            `;
            modal.innerHTML = `
                <div style="background-color: var(--blanco); padding: 25px; border-radius: 10px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.3); text-align: center; max-width: 400px;
                    font-family: 'Roboto', sans-serif; color: var(--texto-oscuro);">
                    <p style="margin-bottom: 20px; font-size: 1.1em;">${message}</p>
                    <button class="button" style="padding: 10px 25px; font-size: 1em;">OK</button>
                </div>
            `;
            document.body.appendChild(modal);
            modal.querySelector('button').onclick = () => modal.remove();
        }
        function createCustomConfirm(message, onConfirm) {
            const modalId = 'customConfirmModal';
            let modal = document.getElementById(modalId);
            if (modal) modal.remove(); 
            modal = document.createElement('div');
            modal.id = modalId;
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background-color: rgba(0,0,0,0.6); display: flex;
                justify-content: center; align-items: center; z-index: 10000;
            `;
            modal.innerHTML = `
                <div style="background-color: var(--blanco); padding: 25px; border-radius: 10px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.3); text-align: center; max-width: 400px;
                    font-family: 'Roboto', sans-serif; color: var(--texto-oscuro);">
                    <p style="margin-bottom: 20px; font-size: 1.1em;">${message}</p>
                    <button id="confirmYes" class="button" style="margin-right: 10px; padding: 10px 20px; font-size: 1em;">S√≠</button>
                    <button id="confirmNo" class="button clear-button" style="padding: 10px 20px; font-size: 1em;">No</button>
                </div>
            `;
            document.body.appendChild(modal);
            modal.querySelector('#confirmYes').onclick = () => {
                onConfirm();
                modal.remove();
            };
            modal.querySelector('#confirmNo').onclick = () => modal.remove();
        }

        // --- TMO CALCULATOR LOGIC (Integrated) ---
        function initializeTMOCalculator() {
            const minutesInput = document.querySelector('#tab6 #minutesInput');
            const convertBtn = document.querySelector('#tab6 #convertBtn');
            const secondsResult = document.querySelector('#tab6 #secondsResult');

            if (convertBtn && minutesInput && secondsResult) {
                convertBtn.addEventListener('click', () => {
                    const minutes = parseFloat(minutesInput.value);

                    if (isNaN(minutes)) {
                        createCustomAlert("Por favor, ingrese un n√∫mero v√°lido para los minutos.");
                        secondsResult.textContent = "Error";
                        secondsResult.classList.remove('result-red', 'result-green'); // Remove any previous color
                    } else if (minutes < 0) {
                        createCustomAlert("Los minutos no pueden ser negativos.");
                        secondsResult.textContent = "Error";
                        secondsResult.classList.remove('result-red', 'result-green'); // Remove any previous color
                    } else {
                        const seconds = Math.floor(minutes * 60); // Round down to the nearest whole number
                        secondsResult.textContent = `${seconds} Segundos`;

                        // Logic to change color based on time (threshold changed to 372 seconds)
                        const thresholdSeconds = 372; 
                        if (seconds > thresholdSeconds) {
                            secondsResult.classList.add('result-red');
                            secondsResult.classList.remove('result-green');
                        } else {
                            secondsResult.classList.add('result-green');
                            secondsResult.classList.remove('result-red');
                        }
                    }
                });
            } else {
                console.error("Error: One or more TMO calculator elements not found in tab6.");
            }
        }

        // --- Important Notice Modal Logic ---
        const importantNoticeModal = document.getElementById('importantNoticeModal');
        const closeNoticeModalBtn = document.getElementById('closeNoticeModalBtn');

        function showImportantNoticeModal() {
            if (importantNoticeModal) {
                importantNoticeModal.style.display = 'flex';
            }
        }

        if (closeNoticeModalBtn) {
            closeNoticeModalBtn.addEventListener('click', () => {
                if (importantNoticeModal) {
                    importantNoticeModal.style.display = 'none';
                }
            });
        }


        // Final initializations
        if (document.querySelector('.tab-link.active')) {
            document.getElementById(document.querySelector('.tab-link.active').dataset.tab).classList.add('active');
        }
        // Call TMO calculator initialization
        initializeTMOCalculator();

        // Se elimin√≥ el listener duplicado para #tab2, ahora se maneja en renderMemoFields y addCheckboxItem
    }); // End DOMContentLoaded
    </script>
</body>
</html>
